(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,24394,e=>{"use strict";var t,a,n=e.i(71645);function r(){return(r=Object.assign.bind()).apply(null,arguments)}e.s(["default",0,function(e){return n.createElement("svg",r({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},e),t||(t=n.createElement("path",{d:"M2.5 2.5h1.571v1.571H2.5zm3.143 3.143H4.07V4.07h1.572zm1.571 1.571H5.643V5.643h1.571zm1.572 0H7.214v1.572H5.643v1.571H4.07v1.572H2.5V13.5h1.571v-1.571h1.572v-1.572h1.571V8.786h1.572v1.571h1.571v1.572h1.572V13.5H13.5v-1.571h-1.571v-1.572h-1.572V8.786H8.786zm1.571-1.571v1.571H8.786V5.643zM11.93 4.07v1.572h-1.572V4.07zm0 0V2.5H13.5v1.571z"})),a||(a=n.createElement("path",{d:"M12.429 3.571V3H13v.571zm-1.572 1.572V4.57h.572v.572zM9.286 6.714v-.571h.571v.571zm-1 1v.572h-.572v-.572zM6.143 6.143h.571v.571h-.571zM4.57 4.57h.572v.572H4.57zm-1-1H3V3h.571zm3.143 5.715v.571h-.571v-.571zm-1.571 1.571v.572H4.57v-.572zM3.57 12.43V13H3v-.571zm6.286-2.572h-.571v-.571h.571zm1 1h.572v.572h-.572zm1.572 1.572H13V13h-.571z"})))}])},23569,e=>{e.v("/_next/static/media/rosie-starry-eyed-portrait-icon.a2981284.png")},88333,e=>{"use strict";let t={src:e.i(23569).default,width:1080,height:1080,blurWidth:8,blurHeight:8,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAABE0lEQVR42gEIAff+AAgGBwcVDA8bUyc0d4MwSLeUM07HWys5hyMRFy4KCQkKACkcIDJzJD6rnRJA+p8PQ/+eDEH/nxBA/n8ePcVAKC9RADodK3SCDD37mxtO/9BBbv/OOWn/liNO/4cNP/9RITeoAH81UbuhM1r/nilS/8g/b//WaYX/wm58/7M2Yf+dOV/nAIoqUcZ7J0b/XylA/692ff/To57/bzdL/2wjQP+fK1jqAIouVsiMNVf/tFl6/9ujpf/ov7b/v2GC/4c4Vv+aMV/qAFYiPIqNKl/2u2CA/+a3tP7owLf+yHWM/5YvZP1wJUy+AB0LFi9HEzWKUR5FpV85UZtcPUyMViRKr0oUOZQsECFNOY51WrAiBcwAAAAASUVORK5CYII="};e.s(["default",0,t])},73859,e=>{e.v({CloseButton:"GenericCanvasContainer-module-scss-module__R28ieq__CloseButton",CornerButtons:"GenericCanvasContainer-module-scss-module__R28ieq__CornerButtons",FullScreen:"GenericCanvasContainer-module-scss-module__R28ieq__FullScreen",FullScreenButton:"GenericCanvasContainer-module-scss-module__R28ieq__FullScreenButton",InfiniteErrorContainer:"GenericCanvasContainer-module-scss-module__R28ieq__InfiniteErrorContainer",RecordButton:"GenericCanvasContainer-module-scss-module__R28ieq__RecordButton",Recording:"GenericCanvasContainer-module-scss-module__R28ieq__Recording",RecordingButtonContainer:"GenericCanvasContainer-module-scss-module__R28ieq__RecordingButtonContainer",RenderDiv:"GenericCanvasContainer-module-scss-module__R28ieq__RenderDiv",Root:"GenericCanvasContainer-module-scss-module__R28ieq__Root",SubscribeBannerContainer:"GenericCanvasContainer-module-scss-module__R28ieq__SubscribeBannerContainer",fadeAndScaleIn:"GenericCanvasContainer-module-scss-module__R28ieq__fadeAndScaleIn",fadeAndScaleOut:"GenericCanvasContainer-module-scss-module__R28ieq__fadeAndScaleOut",pulse:"GenericCanvasContainer-module-scss-module__R28ieq__pulse",pulseBackground:"GenericCanvasContainer-module-scss-module__R28ieq__pulseBackground",scaleIn:"GenericCanvasContainer-module-scss-module__R28ieq__scaleIn",scaleOut:"GenericCanvasContainer-module-scss-module__R28ieq__scaleOut"})},3154,e=>{e.v({SubscribeBanner:"SubscribeBanner-module-scss-module__E5N73a__SubscribeBanner",fadeAndScaleIn:"SubscribeBanner-module-scss-module__E5N73a__fadeAndScaleIn",fadeAndScaleOut:"SubscribeBanner-module-scss-module__E5N73a__fadeAndScaleOut",pulseBackground:"SubscribeBanner-module-scss-module__E5N73a__pulseBackground",scaleIn:"SubscribeBanner-module-scss-module__E5N73a__scaleIn",scaleOut:"SubscribeBanner-module-scss-module__E5N73a__scaleOut"})},44624,22326,74708,21847,e=>{"use strict";var t,a,n,r,o=e.i(71645);function s(){return(s=Object.assign.bind()).apply(null,arguments)}function i(){return(i=Object.assign.bind()).apply(null,arguments)}e.s(["default",0,function(e){return o.createElement("svg",s({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 22 22"},e),t||(t=o.createElement("path",{fill:"currentColor",d:"M11.917 2.75h7.333v7.333h-1.833V6.417h-1.834V4.583h-3.666zm-7.334 9.167v3.666h1.834v1.834H4.583h5.5v1.833H2.75v-7.333zM19.25 11.917v7.333h-7.333v-1.833h3.666v-1.834h1.834v-3.666zm-9.167-7.334H6.417v1.833H4.583V4.583v5.5H2.75V2.75h7.333z"})))}],44624),e.s(["default",0,function(e){return o.createElement("svg",i({xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 22 22"},e),a||(a=o.createElement("path",{d:"M11.917 11.917v7.333h1.833v-3.666h1.833V13.75h3.667v-1.833h-7.333m-3.667-5.5V2.75h1.833v7.333H2.75V8.25h5.5-1.833V6.417z"})),n||(n=o.createElement("path",{d:"M11.917 11.917v7.333h1.833v-3.666h1.833V13.75h3.667v-1.833h-7.333m-3.667-5.5V2.75h1.833v7.333H2.75V8.25h5.5-1.833V6.417zM11.917 10.083h7.333V8.25h-3.667V6.417H13.75V2.75h-1.833v7.333m-5.5 3.667H2.75v-1.833h7.333v7.333H8.25v-5.5 1.833H6.417z"})))}],22326);var c=e.i(18050),l=e.i(932),u=e.i(7670),d=e.i(24394);function m(){return(m=Object.assign.bind()).apply(null,arguments)}let f=function(e){return o.createElement("svg",m({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},e),r||(r=o.createElement("circle",{cx:8,cy:8,r:6,fill:"currentColor"})))};var p=e.i(2079),g=e.i(73859);function h(e){let t,a,n,r,s,i,m,h,v=(0,l.c)(22),{iframeRef:b,isFullScreen:w}=e,{setOpen:S,setContent:y}=(0,p.useDialog)(),{startScreenRecording:_,stopScreenRecording:C,isRecording:E}=function(){let[e,t]=(0,o.useState)(!1),a=(0,o.useRef)(null),n=(0,o.useRef)([]),r=(0,o.useCallback)(()=>`recording-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,[]),s=(0,o.useCallback)((e,t)=>{let a=URL.createObjectURL(e),n=document.createElement("a");n.style.display="none",n.href=a,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)},[]);return{startScreenRecording:(0,o.useCallback)(async o=>{if(!e){t(!0);try{let e=o||document.querySelector("iframe");if(e?.contentWindow){let a=r(),n=e.contentWindow,o=await new Promise((e,t)=>{let r=setTimeout(()=>{s(),t(Error("Canvas recording timeout"))},5e3),o=t=>{if("canvasRecordingResponse"===t.data.action&&"requestId"in t.data&&t.data.requestId===a){if(t.data.content.started)return void clearTimeout(r);s(),t.data.content.success&&t.data.content.videoData?e({success:!0,videoData:t.data.content.videoData}):e({success:!1,error:t.data.content.error})}},s=()=>{clearTimeout(r),window.removeEventListener("message",o)};window.addEventListener("message",o),n.postMessage({action:"requestCanvasRecording",recordingAction:"start",requestId:a},"*")});if(o.success&&o.videoData){let e=await fetch(o.videoData),a=await e.blob(),n=new Date().toISOString().slice(0,19).replace(/:/g,"-"),r=`rosebud-recording-${n}.webm`;s(a,r),t(!1);return}}}catch(e){}try{if(!navigator.mediaDevices?.getDisplayMedia)throw Error("Screen recording not supported in this browser");let e=await navigator.mediaDevices.getDisplayMedia({video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!1});n.current=[];let r={mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:25e5};!MediaRecorder.isTypeSupported(r.mimeType)&&(MediaRecorder.isTypeSupported("video/webm;codecs=vp8")?r.mimeType="video/webm;codecs=vp8":MediaRecorder.isTypeSupported("video/webm")&&(r.mimeType="video/webm"));let o=new MediaRecorder(e,r);a.current=o,o.ondataavailable=e=>{e.data.size>0&&n.current.push(e.data)},o.onstop=()=>{let r=new Blob(n.current,{type:"video/webm"}),o=new Date().toISOString().slice(0,19).replace(/:/g,"-"),i=`rosebud-recording-${o}.webm`;s(r,i),e.getTracks().forEach(e=>e.stop()),t(!1),a.current=null},o.start()}catch(e){throw t(!1),e}}},[e,s,r]),stopScreenRecording:(0,o.useCallback)(e=>{if(a.current&&"inactive"!==a.current.state)a.current.stop();else{let t=e||document.querySelector("iframe");if(t?.contentWindow){let e=r();t.contentWindow.postMessage({action:"requestCanvasRecording",recordingAction:"stop",requestId:e},"*")}}},[r]),isRecording:e}}(),[I,R]=(0,o.useState)(!0);v[0]!==b||v[1]!==E||v[2]!==y||v[3]!==S||v[4]!==_||v[5]!==C?(t=async()=>{try{E?C(b.current):await _(b.current)}catch(t){let e="Failed to start recording. Please try again.";t instanceof Error&&(e="NotAllowedError"===t.name?"Screen recording permission denied. Please allow screen recording and try again.":t.message.includes("not supported")?"Recording not supported in this browser. Please try Chrome or Firefox.":`Recording error: ${t.message}`),S(!0),y({title:"Recording Error",body:e})}},v[0]=b,v[1]=E,v[2]=y,v[3]=S,v[4]=_,v[5]=C,v[6]=t):t=v[6];let A=t;v[7]===Symbol.for("react.memo_cache_sentinel")?(a=e=>{e.stopPropagation(),R(!1)},v[7]=a):a=v[7];let H=a;if(!I)return null;let V=E&&g.default.Recording,j=w&&g.default.FullScreen;v[8]!==V||v[9]!==j?(n=(0,u.default)(g.default.RecordingButtonContainer,V,j),v[8]=V,v[9]=j,v[10]=n):n=v[10],v[11]===Symbol.for("react.memo_cache_sentinel")?(r=(0,c.jsx)("button",{onClick:H,className:g.default.CloseButton,title:"Close recording button","aria-label":"Close recording button",children:(0,c.jsx)(d.default,{})}),v[11]=r):r=v[11],v[12]!==A?(s=()=>void A(),v[12]=A,v[13]=s):s=v[13];let x=E?"Stop recording":"Start recording";v[14]===Symbol.for("react.memo_cache_sentinel")?(i=(0,c.jsx)(f,{}),v[14]=i):i=v[14];let k=E?"Stop Recording":"Record Gameplay";return v[15]!==k||v[16]!==s||v[17]!==x?(m=(0,c.jsxs)("button",{onClick:s,className:g.default.RecordButton,title:x,children:[i,k]}),v[15]=k,v[16]=s,v[17]=x,v[18]=m):m=v[18],v[19]!==m||v[20]!==n?(h=(0,c.jsxs)("div",{className:n,children:[r,m]}),v[19]=m,v[20]=n,v[21]=h):h=v[21],h}e.s(["default",()=>h],74708);var v=e.i(57688),b=e.i(22016),w=e.i(88333),S=e.i(3154);function y(e){let t,a,n,r,o=(0,l.c)(6),{message:s}=e;return o[0]===Symbol.for("react.memo_cache_sentinel")?(t=(0,c.jsx)(v.default,{src:w.default,alt:"Rosie Portrait",height:40,width:40,className:S.default.RosiePortrait}),o[0]=t):t=o[0],o[1]!==s?(a=(0,c.jsx)("span",{children:s}),o[1]=s,o[2]=a):a=o[2],o[3]===Symbol.for("react.memo_cache_sentinel")?(n=(0,c.jsx)("div",{children:(0,c.jsx)(b.default,{href:"/profile/my-plan",children:"Upgrade Plan"})}),o[3]=n):n=o[3],o[4]!==a?(r=(0,c.jsxs)("div",{className:S.default.SubscribeBanner,children:[t,a,n]}),o[4]=a,o[5]=r):r=o[5],r}e.s(["default",()=>y],21847)},83560,e=>{e.v({OGPAuthButton:"OgpSignInDialog-module-scss-module__9JWS4a__OGPAuthButton",fadeAndScaleIn:"OgpSignInDialog-module-scss-module__9JWS4a__fadeAndScaleIn",fadeAndScaleOut:"OgpSignInDialog-module-scss-module__9JWS4a__fadeAndScaleOut",pulseBackground:"OgpSignInDialog-module-scss-module__9JWS4a__pulseBackground",scaleIn:"OgpSignInDialog-module-scss-module__9JWS4a__scaleIn",scaleOut:"OgpSignInDialog-module-scss-module__9JWS4a__scaleOut"})},14345,e=>{"use strict";var t=e.i(18050),a=e.i(66027),n=e.i(71645),r=e.i(68834),o=e.i(81949),s=e.i(18566);let i=o.default.create({baseURL:"https://api.staging.opengameprotocol.com"});async function c(e,t,a={}){a.headers={...a.headers,Authorization:`Bearer ${t}`,"x-auth-provider":"player"};try{return await i(e,a)}catch(e){throw o.default.isAxiosError(e)&&e.response?.status===404&&(0,s.notFound)(),e}}async function l(e,t={}){return t.headers={...t.headers,"Content-Type":"application/json"},await i(e,t)}async function u(e,t){return(await l(`/game/getSessionToken?playerId=${e}&apiKey=b772733e-0d91-44f5-93ad-9d0ae979ba42&gameId=${t}`,{method:"GET"})).data}async function d(e){return(await c("/game/savePoints",e.token,{method:"POST",data:{points:e.points}})).data}var m=e.i(72783),f=e.i(932);e.i(48732);var p=e.i(15383),g=e.i(53110),h=e.i(83560);function v(e){let a,n,r,o=(0,f.c)(9),{onSignIn:s}=e,{signOut:i,requireSignIn:c}=(0,p.useAuth)(),{authStatus:l}=(0,g.useCreateAuthStore)();o[0]!==l||o[1]!==s||o[2]!==c||o[3]!==i?(a=async()=>{l===g.AuthStatus.AUTHENTICATED?i({}):await c({callbackIfSignedIn:()=>{s()},autoCloseDialog:!0})},o[0]=l,o[1]=s,o[2]=c,o[3]=i,o[4]=a):a=o[4];let u=a;o[5]===Symbol.for("react.memo_cache_sentinel")?(n=(0,t.jsx)("div",{children:"You have earned points, but they will be lost unless you sign in to Rosebud!"}),o[5]=n):n=o[5];let d=l===g.AuthStatus.AUTHENTICATED?"Sign Out":"Sign In to Rosebud";return o[6]!==u||o[7]!==d?(r=(0,t.jsxs)(t.Fragment,{children:[n,(0,t.jsx)("button",{className:h.default.OGPAuthButton,onClick:u,children:d})]}),o[6]=u,o[7]=d,o[8]=r):r=o[8],r}var b=e.i(2079),w=e.i(72811);let S=(0,r.create)(e=>({ogpInstance:null,setOgpInstance:t=>e({ogpInstance:t})}));async function y(t){let a=new(await e.A(51289)).default({useCustomAuth:!0});return await a.init({gameId:t}),a.gameReadyToPlay(),a}let _=["3bebe390-06da-4b16-a84c-b0db380a00b5","f34b869b-eb9c-4fe9-afa1-c7f9d0b86d4e","69b4edcb-4ff5-437b-80a2-208208e39c51","9381a1a1-6021-4769-a3bb-352427681e3b","623e16a2-d7a1-4a65-9447-c8732659562d","d20f4673-b62d-4a76-8564-f64a839f7136","56a9fb21-bb68-4819-bd9c-a841f8c3289c"];function C(e,r=!0,o){let[s,i]=(0,n.useState)(!1),{setOpen:c,setContent:l}=(0,b.useDialog)(),f=(0,n.useRef)(!1),{ogpInstance:p,setOgpInstance:g}=S(),h=null!==p;(0,n.useEffect)(()=>{let e=async()=>{!h&&(p||g(await y(o)))};_.includes(o)&&e()},[o,h,p,g]),(0,n.useEffect)(()=>{h&&void 0!==e&&h&&p.setPlayerId(e)},[e,h,p]),(0,n.useEffect)(()=>{(async()=>{try{let e=await (0,m.getFirebaseIdToken)();h&&void 0!==e&&p&&(console.log(`Setting custom auth token: ${e}`),p.setCustomAuthToken(e))}catch(e){console.error("Failed to get Firebase ID token:",e)}})()},[h,p]);let{data:E,refetch:I}=(0,a.useQuery)({queryKey:["ogp-user-session",e],queryFn:()=>u(e,o),enabled:void 0!==e&&s}),R=E?.data.token,A=(0,w.useRosebudMutation)({mutationFn:d,hideErrorDialog:!0,onError:e=>{console.error("Submit points error:",e)},onSettled:()=>{console.log("Submit points success")}});async function H(){if(h&&p)return await p.getPoints()}async function V(){if(h&&p)return(await p.listGameRewards()).total}async function j(){if(h&&p)return await p.claimRewards(!0)}return{submitPoints:(0,n.useCallback)(async a=>{if(r&&!f.current){f.current=!0,l({body:(0,t.jsx)(v,{onSignIn:()=>c(!1)}),title:"Sign in required to save points"}),c(!0);return}let n=R;if(!s&&void 0!==e){i(!0);let e=await I();n=e.data?.data.token}if(n)return(await A.mutateAsync({token:n,points:a})).data.savePoints},[s,e,R,r,A,I,l,c]),listPoints:H,listRewards:V,claimRewards:j,isSDKLoaded:h}}e.s(["OGPGameIds",0,_,"useOpenGameProtocol",()=>C],14345)},35122,e=>{"use strict";var t=e.i(18050),a=e.i(932),n=e.i(78845);e.s(["WarningIcon",0,()=>{let e,r=(0,a.c)(1);return r[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,t.jsx)("svg",{width:n.DEFAULT_SIZE,height:n.DEFAULT_SIZE,viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,t.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.8335 0.833008H9.16683V2.49967H7.50016V4.16634H5.8335V5.83301L4.16683 5.83301V7.49967H2.50016V9.16634H0.833496V10.833L2.50016 10.833V12.4997H4.16683V14.1663H5.8335V15.833H7.50016V17.4997H9.16683V19.1663H10.8335L10.8335 17.4997H12.5002V15.833H14.1668V14.1663H15.8335L15.8335 12.4997H17.5002V10.833L19.1668 10.833V9.16634H17.5002V7.49967H15.8335V5.83301L14.1668 5.83301V4.16634H12.5002V2.49967H10.8335V0.833008ZM10.8335 2.49967L10.8335 4.16634H12.5002V5.83301H14.1668V7.49967H15.8335L15.8335 9.16634H17.5002V10.833H15.8335V12.4997H14.1668V14.1663H12.5002V15.833L10.8335 15.833V17.4997H9.16683V15.833L7.50016 15.833V14.1663H5.8335V12.4997H4.16683V10.833H2.50016V9.16634H4.16683V7.49967H5.8335V5.83301H7.50016V4.16634H9.16683V2.49967H10.8335ZM10.8335 5.83301H9.16683V10.833H10.8335V5.83301ZM10.8335 12.4997H9.16683V14.1663H10.8335V12.4997Z",fill:"currentColor"})}),r[0]=e):e=r[0],e}])},75368,e=>{"use strict";e.i(47167);var t=e.i(18050),a=e.i(932),n=e.i(7670),r=e.i(71645),o=e.i(92599),s=e.i(92096),i=e.i(72783),c=e.i(44624),l=e.i(22326),u=e.i(74708),d=e.i(21847),m=e.i(35122);e.i(48732);var f=e.i(15383),p=e.i(53110),g=e.i(14345),h=e.i(73859);let v=(0,r.forwardRef)(function(e,v){let S,y,_,C,E,I,R,A,H,V,j,x,k=(0,a.c)(30),{projectId:q,revisionId:M,onEvalError:T,showCanvasControls:L}=e,O=void 0===L||L,{requireSignIn:B,user:P}=(0,f.useAuth)(),{authStatus:D}=(0,p.useCreateAuthStore)(),[N,G]=(0,r.useState)(!1),F=(0,r.useRef)(null),[z,U]=(0,r.useState)(!1),{submitPoints:W}=(0,g.useOpenGameProtocol)(P?.id,P?.is_anonymous,q),$=(0,r.useRef)(null),K=(0,r.useRef)(0),J=(0,r.useRef)(null),[Z,Y]=(0,r.useState)(!1),[Q,X]=(0,r.useState)(null);k[0]===Symbol.for("react.memo_cache_sentinel")?(S=()=>({iframe:F.current,takeScreenshot:()=>new Promise((e,t)=>{if(!F.current?.contentWindow)return e({success:!1,error:"Canvas iframe not ready"});if($.current)return t(Error("Screenshot request already in progress."));let a=setTimeout(()=>{$.current&&$.current({success:!1,error:"Screenshot request timed out"})},5e3);$.current=t=>{clearTimeout(a),e(t),$.current=null},F.current.contentWindow.postMessage({action:"requestScreenshot"},"*")})}),y=[],k[0]=S,k[1]=y):(S=k[0],y=k[1]),(0,r.useImperativeHandle)(v,S,y),k[2]===Symbol.for("react.memo_cache_sentinel")?(_=async function(e){let t,a=e.data.payload,n=e.data.requestId;try{t={blob:await (0,o.generateImageInGame)(a)}}catch(e){console.error(e),t={message:"Error fetching asset generation response"}}e.source.postMessage({action:"ephemeralImageGenerationResponse",content:t,requestId:n},e.origin)},k[2]=_):_=k[2];let ee=_;k[3]!==D||k[4]!==T||k[5]!==q||k[6]!==B||k[7]!==W?(C=()=>{let e=async function(e){let t;(0,i.logEventSubmitCharacterChat)(q);let a=e.data.payload;a.project_id=q;let n=e.data.requestId;try{t=await (0,o.getLLMResponse)(a)}catch(a){let e="Error fetching LLM response";a.response?.status===403&&a.response.data?.detail==="No more entitlements available"&&(D===p.AuthStatus.AUTHENTICATED?U(!0):B({callbackIfSignedOut:b}),e=D===p.AuthStatus.AUTHENTICATED?"Subscribe for unlimited messages":"Sign in to continue using AI Chat"),console.error(a),t={message:e}}e.source.postMessage({action:"llmResponse",content:t,requestId:n},e.origin)},t=async function(e){let t=e.data.points;(0,i.logEventOgpSubmitPoints)(t);let a=e.data.requestId,n=await W(t);e.source.postMessage({action:"ogpSubmitPoints",content:n,requestId:a},e.origin)},a=async a=>{let n=a.data.action;switch(n){case"codeError":if(!T)return;K.current=K.current+1,J.current||(J.current=setTimeout(()=>{K.current>10&&Y(!0),J.current=null,K.current=0},1e3)),T(a.data.content);break;case"logProgress":(0,i.logGameEvent)(a.data.content.eventName,a.data.content.eventData);break;case"requestLLM":await e(a);break;case"requestEphemeralImageGeneration":await ee(a);break;case"ogpSubmitPoints":await t(a);break;case"screenshotResponse":{let{content:e}=a.data;$.current&&$.current(e);break}case"localStorageChanged":break;case"redirectToProject":window.location.pathname.startsWith("/p/")?window.location.href=`/p/${a.data.projectId}`:X(`/p/${a.data.projectId}`);break;case"trackFacebookEvent":{let{event:e,params:t}=a.data,n=(0,s.getCookie)("_fbp"),r=(0,s.getCookie)("_fbc"),o={...t,...n&&{fbp:n},...r&&{fbc:r}};"InitiateCheckout"===e?window.fbq&&window.fbq("track","InitiateCheckout",o):"Purchase"===e&&window.fbq&&window.fbq("track","Purchase",o);break}default:return n}},n=e=>void a(e);return window.addEventListener("message",n),()=>{window.removeEventListener("message",n)}},E=[T,q,D,B,W],k[3]=D,k[4]=T,k[5]=q,k[6]=B,k[7]=W,k[8]=C,k[9]=E):(C=k[8],E=k[9]),(0,r.useEffect)(C,E),k[10]===Symbol.for("react.memo_cache_sentinel")?(I=()=>{G(w)},k[10]=I):I=k[10];let et=I,ea=N&&h.default.FullScreen;return k[11]!==ea?(R=(0,n.default)(h.default.Root,ea),k[11]=ea,k[12]=R):R=k[12],k[13]!==N||k[14]!==O?(A=O&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:et,className:(0,n.default)(h.default.FullScreenButton,N&&h.default.FullScreen),title:N?"Exit fullscreen":"Enter fullscreen",children:N?(0,t.jsx)(l.default,{}):(0,t.jsx)(c.default,{})}),(0,t.jsx)(u.default,{iframeRef:F,isFullScreen:N})]}),k[13]=N,k[14]=O,k[15]=A):A=k[15],k[16]!==Q||k[17]!==Z||k[18]!==M?(H=!Z&&(0,t.jsx)("iframe",{ref:F,src:Q??`https://playground-gateway-v2-snduoq54tq-uc.a.run.app/api/server/${M}/index.html`,className:h.default.RenderDiv,sandbox:"allow-scripts allow-same-origin allow-pointer-lock allow-downloads allow-forms allow-popups allow-popups-to-escape-sandbox",allow:"accelerometer; autoplay; camera; encrypted-media; fullscreen; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; payment; usb; vr; xr-spatial-tracking; screen-wake-lock; magnetometer; ambient-light-sensor; battery; gamepad; picture-in-picture; display-capture; bluetooth;","data-hj-allow-iframe":!0}),k[16]=Q,k[17]=Z,k[18]=M,k[19]=H):H=k[19],k[20]!==Z?(V=Z&&(0,t.jsxs)("div",{className:h.default.InfiniteErrorContainer,children:[(0,t.jsx)(m.WarningIcon,{}),(0,t.jsx)("span",{children:"Infinite error loop detected. Please check your code."})]}),k[20]=Z,k[21]=V):V=k[21],k[22]!==z?(j=z&&(0,t.jsx)("div",{className:h.default.SubscribeBannerContainer,children:(0,t.jsx)(d.default,{message:"To continue enjoying the AI chat features in this project, please upgrade your plan."})}),k[22]=z,k[23]=j):j=k[23],k[24]!==A||k[25]!==H||k[26]!==V||k[27]!==j||k[28]!==R?(x=(0,t.jsxs)("div",{className:R,children:[A,H,V,j]}),k[24]=A,k[25]=H,k[26]=V,k[27]=j,k[28]=R,k[29]=x):x=k[29],x});function b(){}function w(e){return!e}e.s(["default",0,v],75368)},73119,43543,7668,e=>{"use strict";e.i(47167);var t=e.i(18050),a=e.i(932),n=e.i(7670),r=e.i(71645),o=e.i(92599),s=e.i(72783),i=e.i(44624),c=e.i(22326),l=e.i(74708),u=e.i(21847);e.i(48732);var d=e.i(15383),m=e.i(53110),f=e.i(14345),p=e.i(73859);let g=(0,r.forwardRef)(function(e,g){let b,w,S,y,_,C,E,I,R,A,H,V,j,x,k,q,M,T,L,O=(0,a.c)(46),{file:B,projectId:P,canvasType:D,onEvalError:N,onScriptsLoaded:G,showCanvasControls:F}=e,z=void 0===F||F,{requireSignIn:U,user:W}=(0,d.useAuth)(),{authStatus:$}=(0,m.useCreateAuthStore)(),{isClientIOS:K,handleLocalStorageChanged:J,notifyNoEntitlementsRemainingIOS:Z}=function(){let e,t,n,o,s,i=(0,a.c)(10),[c,l]=(0,r.useState)(!1);i[0]===Symbol.for("react.memo_cache_sentinel")?(e=()=>{l(void 0!==window.webkit?.messageHandlers?.callbackHandler)},t=[],i[0]=e,i[1]=t):(e=i[0],t=i[1]),(0,r.useEffect)(e,t),i[2]!==c?(n=e=>{var t;if("object"==typeof(t=e.data)&&null!==t&&"content"in t){let t=e.data.content;c&&window.webkit?.messageHandlers?.callbackHandler.postMessage({action:"IframeLocalStorageChanged",content:JSON.stringify(t)})}else console.warn("Received a message event with an unexpected data structure:",e.data)},i[2]=c,i[3]=n):n=i[3];let u=n;i[4]!==c?(o=()=>{c&&window.webkit?.messageHandlers?.callbackHandler.postMessage({action:"NoEntitlementsRemaining"})},i[4]=c,i[5]=o):o=i[5];let d=o;return i[6]!==u||i[7]!==c||i[8]!==d?(s={isClientIOS:c,handleLocalStorageChanged:u,notifyNoEntitlementsRemainingIOS:d},i[6]=u,i[7]=c,i[8]=d,i[9]=s):s=i[9],s}();O[0]!==D?(b=()=>`https://canvas.play.rosebud.ai/canvas/${D}`,O[0]=D,O[1]=b):b=O[1];let[Y,Q]=(0,r.useState)(b),[X,ee]=(0,r.useState)(!1),et=(0,r.useRef)(null),[ea,en]=(0,r.useState)(!1),{submitPoints:er}=(0,f.useOpenGameProtocol)(W?.id,W?.is_anonymous,P);O[2]===Symbol.for("react.memo_cache_sentinel")?(w=()=>et.current,S=[et],O[2]=w,O[3]=S):(w=O[2],S=O[3]),(0,r.useImperativeHandle)(g,w,S),O[4]===Symbol.for("react.memo_cache_sentinel")?(y=()=>{ee(h)},O[4]=y):y=O[4];let eo=y;O[5]===Symbol.for("react.memo_cache_sentinel")?(_=function(e){et.current&&et.current.contentWindow&&et.current.contentWindow.postMessage({action:"setLocalStorage",data:e},"*")},O[5]=_):_=O[5];let es=_;O[6]!==K?(C=()=>{K&&(window.setIframeLocalStorage=es)},E=[K],O[6]=K,O[7]=C,O[8]=E):(C=O[7],E=O[8]),(0,r.useEffect)(C,E),O[9]!==D||O[10]!==K?(R=()=>{let e=`https://canvas.play.rosebud.ai/canvas/${D}`;"phaser"===D&&K&&(e+="_webkit"),Q(e+=window.location.hash)},I=[D,K],O[9]=D,O[10]=K,O[11]=I,O[12]=R):(I=O[11],R=O[12]),(0,r.useEffect)(R,I),O[13]===Symbol.for("react.memo_cache_sentinel")?(A=async function(e){let t,a=e.data.payload,n=e.data.requestId;try{t={blob:await (0,o.generateImageInGame)(a)}}catch(e){console.error(e),t={message:"Error fetching asset generation response"}}e.source.postMessage({action:"ephemeralImageGenerationResponse",content:t,requestId:n},e.origin)},O[13]=A):A=O[13];let ei=A;O[14]!==$||O[15]!==B.content||O[16]!==J||O[17]!==K||O[18]!==Z||O[19]!==N||O[20]!==G||O[21]!==P||O[22]!==U||O[23]!==er?(H=()=>{let e=async function(e){let t;(0,s.logEventSubmitCharacterChat)(P);let a=e.data.payload;a.project_id=P;let n=e.data.requestId;try{t=await (0,o.getLLMResponse)(a)}catch(a){let e="Error fetching LLM response";a.response?.status===403&&a.response.data?.detail==="No more entitlements available"&&(K?Z():$===m.AuthStatus.AUTHENTICATED?en(!0):U({callbackIfSignedOut:v}),e=K||$===m.AuthStatus.AUTHENTICATED?"Subscribe for unlimited messages":"Sign in to continue using AI Chat"),console.error(a),t={message:e}}e.source.postMessage({action:"llmResponse",content:t,requestId:n},e.origin)},t=async function(e){let t=e.data.points;(0,s.logEventOgpSubmitPoints)(t);let a=e.data.requestId,n=await er(t);e.source.postMessage({action:"ogpSubmitPoints",content:n,requestId:a},e.origin)},a=async a=>{let{action:n}=a.data;"codeError"===n&&N&&N(a.data.content),"logProgress"===n&&(0,s.logGameEvent)(a.data.content.eventName,a.data.content.eventData),"scriptsLoaded"===n&&G&&G(a.data.content),"requestLLM"===n&&await e(a),"localStorageChanged"===n&&J(a),"requestEphemeralImageGeneration"===n&&await ei(a),"ogpSubmitPoints"===n&&await t(a)},n=e=>void a(e);if(B.content)return window.addEventListener("message",n),()=>{window.removeEventListener("message",n)}},V=[N,B.content,G,P,$,U,er,K,Z,J],O[14]=$,O[15]=B.content,O[16]=J,O[17]=K,O[18]=Z,O[19]=N,O[20]=G,O[21]=P,O[22]=U,O[23]=er,O[24]=H,O[25]=V):(H=O[24],V=O[25]),(0,r.useEffect)(H,V),O[26]!==B.content?(j=function(){if(!et.current||!et.current.contentWindow)return;let e={action:"update",content:B.content};et.current.contentWindow.postMessage(e,"*")},O[26]=B.content,O[27]=j):j=O[27];let ec=j,el=X&&p.default.FullScreen;O[28]!==el?(x=(0,n.default)(p.default.Root,el),O[28]=el,O[29]=x):x=O[29],O[30]!==X||O[31]!==z?(k=z&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:eo,className:p.default.FullScreenButton,children:X?(0,t.jsx)(c.default,{}):(0,t.jsx)(i.default,{})}),(0,t.jsx)(l.default,{iframeRef:et,isFullScreen:X})]}),O[30]=X,O[31]=z,O[32]=k):k=O[32];let eu=`${B.id}-${B.modified}`;return O[33]!==ec?(q=()=>setTimeout(ec,100),O[33]=ec,O[34]=q):q=O[34],O[35]!==Y||O[36]!==eu||O[37]!==q?(M=(0,t.jsx)("iframe",{ref:et,src:Y,className:p.default.RenderDiv,sandbox:"allow-scripts allow-same-origin allow-pointer-lock allow-downloads allow-forms allow-popups allow-popups-to-escape-sandbox",onLoad:q,allow:"accelerometer; autoplay; camera; encrypted-media; fullscreen; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; payment; usb; vr; xr-spatial-tracking; screen-wake-lock; magnetometer; ambient-light-sensor; battery; gamepad; picture-in-picture; display-capture; bluetooth;","data-hj-allow-iframe":!0},eu),O[35]=Y,O[36]=eu,O[37]=q,O[38]=M):M=O[38],O[39]!==ea?(T=ea&&(0,t.jsx)("div",{className:p.default.SubscribeBannerContainer,children:(0,t.jsx)(u.default,{message:"To continue enjoying the AI chat features in this project, please upgrade your plan."})}),O[39]=ea,O[40]=T):T=O[40],O[41]!==x||O[42]!==k||O[43]!==M||O[44]!==T?(L=(0,t.jsxs)("div",{className:x,children:[k,M,T]}),O[41]=x,O[42]=k,O[43]=M,O[44]=T,O[45]=L):L=O[45],L});function h(e){return!e}function v(){}e.s(["default",0,g],73119);var b=e.i(24174),w=e.i(54452),S=e.i(35122);let y=(0,r.forwardRef)(function(e,l){let g,h,v,b,w,y,_,R,A,H,V,j,x,k,q,M,T=(0,a.c)(40),{files:L,projectId:O,canvasType:B,onEvalError:P,onScriptsLoaded:D,showCanvasControls:N}=e,G=void 0===N||N,{requireSignIn:F,user:z}=(0,d.useAuth)(),{authStatus:U}=(0,m.useCreateAuthStore)();T[0]!==B?(g=()=>`https://canvas.play.rosebud.ai/canvas/${B}`,T[0]=B,T[1]=g):g=T[1];let[W,$]=(0,r.useState)(g),[K,J]=(0,r.useState)(!1),Z=(0,r.useRef)(null),[Y,Q]=(0,r.useState)(!1),{submitPoints:X}=(0,f.useOpenGameProtocol)(z?.id,z?.is_anonymous,O),ee=(0,r.useRef)(null),et=(0,r.useRef)(0),ea=(0,r.useRef)(null),[en,er]=(0,r.useState)(!1);T[2]===Symbol.for("react.memo_cache_sentinel")?(h=()=>({iframe:Z.current,takeScreenshot:()=>new Promise((e,t)=>{if(!Z.current?.contentWindow)return e({success:!1,error:"Canvas iframe not ready"});if(ee.current)return t(Error("Screenshot request already in progress."));let a=setTimeout(()=>{ee.current&&ee.current({success:!1,error:"Screenshot request timed out"})},5e3);ee.current=t=>{clearTimeout(a),e(t),ee.current=null},Z.current.contentWindow.postMessage({action:"requestScreenshot"},"*")})}),v=[],T[2]=h,T[3]=v):(h=T[2],v=T[3]),(0,r.useImperativeHandle)(l,h,v),T[4]!==B?(b=()=>{let e=`https://canvas.play.rosebud.ai/canvas/${B}`;$(e+=window.location.hash)},w=[B],T[4]=B,T[5]=b,T[6]=w):(b=T[5],w=T[6]),(0,r.useEffect)(b,w),T[7]===Symbol.for("react.memo_cache_sentinel")?(y=async function(e){let t,a=e.data.payload,n=e.data.requestId;try{t={blob:await (0,o.generateImageInGame)(a)}}catch(e){console.error(e),t={message:"Error fetching asset generation response"}}e.source.postMessage({action:"ephemeralImageGenerationResponse",content:t,requestId:n},e.origin)},T[7]=y):y=T[7];let eo=y;if(T[8]!==U||T[9]!==P||T[10]!==D||T[11]!==O||T[12]!==F||T[13]!==X?(_=()=>{let e=async function(e){let t;(0,s.logEventSubmitCharacterChat)(O);let a=e.data.payload;a.project_id=O;let n=e.data.requestId;try{t=await (0,o.getLLMResponse)(a)}catch(a){let e="Error fetching LLM response";a.response?.status===403&&a.response.data?.detail==="No more entitlements available"&&(U===m.AuthStatus.AUTHENTICATED?Q(!0):F({callbackIfSignedOut:C}),e=U===m.AuthStatus.AUTHENTICATED?"Subscribe for unlimited messages":"Sign in to continue using AI Chat"),console.error(a),t={message:e}}e.source.postMessage({action:"llmResponse",content:t,requestId:n},e.origin)},t=async function(e){let t=e.data.points;(0,s.logEventOgpSubmitPoints)(t);let a=e.data.requestId,n=await X(t);e.source.postMessage({action:"ogpSubmitPoints",content:n,requestId:a},e.origin)},a=async a=>{let n=a.data.action;if("codeError"===n&&P&&(et.current=et.current+1,ea.current||(ea.current=setTimeout(()=>{et.current>10&&er(!0),ea.current=null,et.current=0},1e3)),P(a.data.content)),"logProgress"===n&&(0,s.logGameEvent)(a.data.content.eventName,a.data.content.eventData),"scriptsLoaded"===n&&D&&D(a.data.content),"requestLLM"===n&&await e(a),"requestEphemeralImageGeneration"===n&&await eo(a),"ogpSubmitPoints"===n&&await t(a),"screenshotResponse"===n){let{content:e}=a.data;ee.current&&ee.current(e)}},n=e=>void a(e);return window.addEventListener("message",n),()=>{window.removeEventListener("message",n)}},R=[P,D,O,U,F,X],T[8]=U,T[9]=P,T[10]=D,T[11]=O,T[12]=F,T[13]=X,T[14]=_,T[15]=R):(_=T[14],R=T[15]),(0,r.useEffect)(_,R),0===L.length){let e;return T[16]===Symbol.for("react.memo_cache_sentinel")?(e=(0,t.jsx)("div",{children:"No files"}),T[16]=e):e=T[16],e}if(L.some(E)){let e;return T[17]===Symbol.for("react.memo_cache_sentinel")?(e=(0,t.jsx)("div",{children:"Some files are missing"}),T[17]=e):e=T[17],e}T[18]===Symbol.for("react.memo_cache_sentinel")?(A=()=>{J(I)},T[18]=A):A=T[18];let es=A;T[19]!==L?(H=function(){Z.current&&Z.current.contentWindow&&Z.current.contentWindow.postMessage({type:"fileSystem",files:L},"*")},T[19]=L,T[20]=H):H=T[20];let ei=H,ec=K&&p.default.FullScreen;return T[21]!==ec?(V=(0,n.default)(p.default.Root,ec),T[21]=ec,T[22]=V):V=T[22],T[23]!==K||T[24]!==G?(j=G&&(0,t.jsx)("button",{onClick:es,className:p.default.FullScreenButton,children:K?(0,t.jsx)(c.default,{}):(0,t.jsx)(i.default,{})}),T[23]=K,T[24]=G,T[25]=j):j=T[25],T[26]!==en||T[27]!==ei||T[28]!==W?(x=!en&&(0,t.jsx)("iframe",{ref:Z,src:W,className:p.default.RenderDiv,sandbox:"allow-scripts allow-same-origin allow-pointer-lock allow-downloads allow-forms allow-popups allow-popups-to-escape-sandbox",onLoad:()=>setTimeout(ei,100),allow:"accelerometer; autoplay; camera; encrypted-media; fullscreen; geolocation; gyroscope; microphone; midi; clipboard-read; clipboard-write; payment; usb; vr; xr-spatial-tracking; screen-wake-lock; magnetometer; ambient-light-sensor; battery; gamepad; picture-in-picture; display-capture; bluetooth;","data-hj-allow-iframe":!0}),T[26]=en,T[27]=ei,T[28]=W,T[29]=x):x=T[29],T[30]!==en?(k=en&&(0,t.jsxs)("div",{className:p.default.InfiniteErrorContainer,children:[(0,t.jsx)(S.WarningIcon,{}),(0,t.jsx)("span",{children:"Infinite error loop detected. Please check your code."})]}),T[30]=en,T[31]=k):k=T[31],T[32]!==Y?(q=Y&&(0,t.jsx)("div",{className:p.default.SubscribeBannerContainer,children:(0,t.jsx)(u.default,{message:"To continue enjoying the AI chat features in this project, please upgrade your plan."})}),T[32]=Y,T[33]=q):q=T[33],T[34]!==V||T[35]!==j||T[36]!==x||T[37]!==k||T[38]!==q?(M=(0,t.jsxs)("div",{className:V,children:[j,x,k,q]}),T[34]=V,T[35]=j,T[36]=x,T[37]=k,T[38]=q,T[39]=M):M=T[39],M}),_=(0,r.forwardRef)(function(e,n){let r,s,i,c,l,u=(0,a.c)(16),{revisionId:d,projectId:m,canvasType:f,onEvalError:p,onScriptsLoaded:g,showCanvasControls:h}=e,v=void 0===h||h;u[0]!==d?(r={queryKey:["files",{revision:d}],queryFn:()=>(0,o.getAllGenericFiles)({revision:d})},u[0]=d,u[1]=r):r=u[1];let{data:S}=(0,w.useSuspenseQuery)(r);u[2]!==S?(s=S?.map(R),u[2]=S,u[3]=s):s=u[3],u[4]!==s?(i={queries:s},u[4]=s,u[5]=i):i=u[5];let _=(0,b.useSuspenseQueries)(i);return u[6]!==_?(c=_.map(A),u[6]=_,u[7]=c):c=u[7],u[8]!==f||u[9]!==n||u[10]!==p||u[11]!==g||u[12]!==m||u[13]!==v||u[14]!==c?(l=(0,t.jsx)(y,{ref:n,files:c,projectId:m,canvasType:f,onEvalError:p,onScriptsLoaded:g,showCanvasControls:v}),u[8]=f,u[9]=n,u[10]=p,u[11]=g,u[12]=m,u[13]=v,u[14]=c,u[15]=l):l=u[15],l});function C(){}function E(e){return!e}function I(e){return!e}function R(e){return{queryKey:["files",e.id],queryFn:()=>(0,o.getGenericFile)(e.id)}}function A(e){return e.data}e.s(["GenericCanvasContainerMultiFileRevisionShim",()=>_,"default",0,y],43543);var H=e.i(29011);function V(e){if(e==H.Mode.BABYLON)return"babylon";if(e==H.Mode.PHASER)return"phaser";if(e==H.Mode.VOXEL)return"noa";if(e==H.Mode.THREEJS)return"threejs";if(e==H.Mode.REACT)return"react";else if(e==H.Mode.MULTIFILE)return"esm-react";throw Error("Project mode not supported!")}e.s(["getCanvasTypeFromProjectMode",()=>V],7668)}]);