(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,12086,e=>{"use strict";let t={src:e.i(95585).default,width:476,height:624,blurWidth:6,blurHeight:8,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAICAYAAADaxo44AAAAa0lEQVR42pXIOwqFMABE0ZnyFWLzDMQPCn5jtE0hWur+l2RGV+DAheEAn2fyOeaQ2Td9GVZ/cPU7vds4x/Rl6KuFjR3YFu5JX4Yun+hKzyHiGNOXIf2lCE2gSQxUqANl6P8dr+mkTSyUvuwGgdgO+PfdQ9oAAAAASUVORK5CYII="};e.s(["default",0,t])},84720,e=>{e.v({SwitcherButton:"VideoSwitcher-module-scss-module__3D9VNq__SwitcherButton",fadeAndScaleIn:"VideoSwitcher-module-scss-module__3D9VNq__fadeAndScaleIn",fadeAndScaleOut:"VideoSwitcher-module-scss-module__3D9VNq__fadeAndScaleOut",pulseBackground:"VideoSwitcher-module-scss-module__3D9VNq__pulseBackground",scaleIn:"VideoSwitcher-module-scss-module__3D9VNq__scaleIn",scaleOut:"VideoSwitcher-module-scss-module__3D9VNq__scaleOut"})},98600,75479,67270,e=>{"use strict";var t,a=e.i(18050),l=e.i(932),o=e.i(18566),n=e.i(71645);function s(){return(s=Object.assign.bind()).apply(null,arguments)}let i=function(e){return n.createElement("svg",s({xmlns:"http://www.w3.org/2000/svg",width:20,height:20,fill:"currentColor"},e),t||(t=n.createElement("path",{d:"M6.667 4.167h1.666v1.666H6.667zM5 5.833h1.667V7.5H5zM3.333 7.5H5v1.667H3.333zM1.667 9.167h1.666v1.666H1.667zm1.666 1.666H5V12.5H3.333zM5 12.5h1.667v1.667H5zm1.667 1.667h1.666v1.666H6.667zm6.666-10h-1.666v1.666h1.666zM15 5.833h-1.667V7.5H15zM16.667 7.5H15v1.667h1.667zm1.666 1.667h-1.666v1.666h1.666zm-1.666 1.666H15V12.5h1.667zM15 12.5h-1.667v1.667H15zm-1.667 1.667h-1.666v1.666h1.666z"})))};e.s(["default",0,i],75479);var r=e.i(78845);function d(){let e,t=(0,l.c)(1);return t[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,a.jsxs)("svg",{width:r.DEFAULT_SIZE,height:r.DEFAULT_SIZE,viewBox:"0 0 16 16",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:[(0,a.jsx)("rect",{x:"5.5",y:"1",width:"5",height:"3"}),(0,a.jsx)("rect",{x:"1.5",y:"11",width:"5",height:"3"}),(0,a.jsx)("rect",{x:"9.5",y:"11",width:"5",height:"3"}),(0,a.jsx)("rect",{x:"7.5",y:"4",width:"1",height:"5"}),(0,a.jsx)("rect",{x:"3.5",y:"8",width:"9",height:"1"}),(0,a.jsx)("rect",{x:"3.5",y:"9",width:"1",height:"2"}),(0,a.jsx)("rect",{x:"11.5",y:"9",width:"1",height:"2"})]}),t[0]=e):e=t[0],e}e.i(80380);var u=e.i(14978),c=e.i(84720),m=e.i(8155),_=e.i(68834);let f=new Map;function h(e,t){let a,o=(0,l.c)(2);if(o[0]!==e)f.has(e)||f.set(e,(0,m.createStore)(e=>({activeMode:"not-videogen",setActiveMode:t=>e({activeMode:t})}))),a=f.get(e),o[0]=e,o[1]=a;else a=o[1];let n=a;return(0,_.useStore)(n,t||v)}function v(e){return e}function A(){let e,t,n,s,r,m,_,f=(0,l.c)(16),{project:v}=(0,u.default)(),A=(0,o.useRouter)(),{activeMode:p,setActiveMode:g}=h(v.id);if("not-videogen"===p)return null;f[0]!==p||f[1]!==g?(e=function(){g("chat"===p?"video":"chat")},f[0]=p,f[1]=g,f[2]=e):e=f[2];let S=e,b="chat"===p?"Switch to Video View":"Switch to Code View";return f[3]===Symbol.for("react.memo_cache_sentinel")?(t=(0,a.jsx)(i,{}),f[3]=t):t=f[3],f[4]!==b||f[5]!==S?(n=(0,a.jsx)("button",{className:c.default.SwitcherButton,onClick:S,title:b,children:t}),f[4]=b,f[5]=S,f[6]=n):n=f[6],f[7]!==v.id||f[8]!==A?(s=()=>{A.push(`${v.id}/videograph`)},f[7]=v.id,f[8]=A,f[9]=s):s=f[9],f[10]===Symbol.for("react.memo_cache_sentinel")?(r=(0,a.jsx)(d,{}),f[10]=r):r=f[10],f[11]!==s?(m=(0,a.jsx)("button",{className:c.default.SwitcherButton,title:"Switch to graph view",onClick:s,children:r}),f[11]=s,f[12]=m):m=f[12],f[13]!==n||f[14]!==m?(_=(0,a.jsxs)(a.Fragment,{children:[n,m]}),f[13]=n,f[14]=m,f[15]=_):_=f[15],_}e.s(["useVideoChatSwitcherStore",()=>h],67270),e.s(["default",()=>A],98600)},36382,e=>{"use strict";var t=e.i(71645),a=e.i(40143),l=e.i(19273),o=e.i(12598);function n(e,t){let a=(0,o.useQueryClient)(t);return i({filters:{...e,status:"pending"}},a).length}function s(e,t){return e.findAll(t.filters).map(e=>t.select?t.select(e):e.state)}function i(e={},n){let r=(0,o.useQueryClient)(n).getMutationCache(),d=t.useRef(e),u=t.useRef(null);return null===u.current&&(u.current=s(r,e)),t.useEffect(()=>{d.current=e}),t.useSyncExternalStore(t.useCallback(e=>r.subscribe(()=>{let t=(0,l.replaceEqualDeep)(u.current,s(r,d.current));u.current!==t&&(u.current=t,a.notifyManager.schedule(e))}),[r]),()=>u.current,()=>u.current)}e.s(["useIsMutating",()=>n,"useMutationState",()=>i])},47931,e=>{e.v({ImagesContainer:"IntroCreator-module-scss-module__KRo5ra__ImagesContainer",IntroWrapper:"IntroCreator-module-scss-module__KRo5ra__IntroWrapper",LoadingSpinner:"IntroCreator-module-scss-module__KRo5ra__LoadingSpinner",PreviewImageBackground:"IntroCreator-module-scss-module__KRo5ra__PreviewImageBackground",PreviewImageContainer:"IntroCreator-module-scss-module__KRo5ra__PreviewImageContainer",VideoGenerationGameMaker:"IntroCreator-module-scss-module__KRo5ra__VideoGenerationGameMaker",fadeAndScaleIn:"IntroCreator-module-scss-module__KRo5ra__fadeAndScaleIn",fadeAndScaleOut:"IntroCreator-module-scss-module__KRo5ra__fadeAndScaleOut",pulseBackground:"IntroCreator-module-scss-module__KRo5ra__pulseBackground",scaleIn:"IntroCreator-module-scss-module__KRo5ra__scaleIn",scaleOut:"IntroCreator-module-scss-module__KRo5ra__scaleOut"})},80085,e=>{e.v({CreationSection:"IntroCreatorStarterScreen-module-scss-module__oraHvq__CreationSection",DragDropContent:"IntroCreatorStarterScreen-module-scss-module__oraHvq__DragDropContent",DragDropWrapper:"IntroCreatorStarterScreen-module-scss-module__oraHvq__DragDropWrapper",ImageAndPromptSection:"IntroCreatorStarterScreen-module-scss-module__oraHvq__ImageAndPromptSection",Inactive:"IntroCreatorStarterScreen-module-scss-module__oraHvq__Inactive",InitialCreator:"IntroCreatorStarterScreen-module-scss-module__oraHvq__InitialCreator",LoadingOverlay:"IntroCreatorStarterScreen-module-scss-module__oraHvq__LoadingOverlay",PromptAreaBottomBar:"IntroCreatorStarterScreen-module-scss-module__oraHvq__PromptAreaBottomBar",SubmitButton:"IntroCreatorStarterScreen-module-scss-module__oraHvq__SubmitButton",Tab:"IntroCreatorStarterScreen-module-scss-module__oraHvq__Tab",UploadImageButton:"IntroCreatorStarterScreen-module-scss-module__oraHvq__UploadImageButton",fadeAndScaleIn:"IntroCreatorStarterScreen-module-scss-module__oraHvq__fadeAndScaleIn",fadeAndScaleOut:"IntroCreatorStarterScreen-module-scss-module__oraHvq__fadeAndScaleOut",pulseBackground:"IntroCreatorStarterScreen-module-scss-module__oraHvq__pulseBackground",scaleIn:"IntroCreatorStarterScreen-module-scss-module__oraHvq__scaleIn",scaleOut:"IntroCreatorStarterScreen-module-scss-module__oraHvq__scaleOut"})},88867,16533,e=>{"use strict";var t=e.i(932),a=e.i(18566),l=e.i(71645);function o(e){let o,i,r,d=(0,t.c)(9),{shouldPrevent:u,onNavigationAttemptAction:c}=e,m=(0,a.useRouter)(),[_,f]=(0,l.useState)(!1);d[0]!==_||d[1]!==c?(o=e=>{let{confirmFn:t,cancelFn:a}=e;_||(f(!0),c({confirm:()=>{t(),f(!1)},cancel:()=>{a(),f(!1)}}))},d[0]=_,d[1]=c,d[2]=o):o=d[2];let h=o;d[3]!==_||d[4]!==m||d[5]!==u||d[6]!==h?(i=()=>{if(!u)return;let e=e=>{if(_)return;let t=e.target.closest("a[href]");if(!t)return;let a=t.getAttribute("href");if(a&&(a.startsWith("/")||a.startsWith(window.location.origin))){let a=new URL(t.href,window.location.origin),l=new URL(window.location.href);if(a.href===l.href||a.pathname===l.pathname&&a.search===l.search&&a.hash!==l.hash)return;e.preventDefault(),e.stopPropagation(),h({confirmFn:()=>m.push(t.href),cancelFn:n})}};return window.addEventListener("beforeunload",s),document.addEventListener("click",e,!0),()=>{window.removeEventListener("beforeunload",s),document.removeEventListener("click",e,!0)}},r=[u,_,m,h],d[3]=_,d[4]=m,d[5]=u,d[6]=h,d[7]=i,d[8]=r):(i=d[7],r=d[8]),(0,l.useEffect)(i,r)}function n(){}function s(e){e.preventDefault(),e.returnValue=""}e.s(["usePreventNavigation",()=>o],88867);var i=e.i(18050),r=e.i(7670),d=e.i(57688),u=e.i(55689),c=e.i(72783);let m={src:e.i(49831).default,width:640,height:357,blurWidth:8,blurHeight:4,blurDataURL:"data:image/webp;base64,UklGRtYAAABXRUJQVlA4TMkAAAAvB8AAAM1VICICHgjACQQAAABEAEBQAAABAAAAAAAAAAAAAAAAAAAAAAAvEEMAcgLwpiCBhiUCAADwQIBNAAAAAM6/bvJevS4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAABCnHxQIBNAAAAAM5fFQACIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIDwQ4+0n5si05ryW6+4EmEP0Wcj2T+6wlabgmGfKcmh5BkotCubMuOtO18GfnZT8CgOcr0yT3dOH3I0qiYA"},_={src:e.i(84394).default,width:1920,height:1088,blurWidth:8,blurHeight:5,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAYAAAB4ka1VAAAAsElEQVR42gGlAFr/AHtuPP9lWS//lHxM/9y1fP+je1D/Tjsn/29fOv9sZDj/AJqKOf96azb/mntM/961dv+2i1v/glxC/5iBRf+aiTv/AIZ6Tf9fTzL/YEY1/7+Zaf+sj2D/tpuK/7Gsp/+Rg17/AKiSTP9iSy7/WEEu/8Kfef/Dp3D/wL+9/7/Ezf+4q4L/AKmOQP+Mc1f/XlA//6KDZP/EqI//r6io/7O2vv+to3//cbNjEdDi/MwAAAAASUVORK5CYII="};var f=e.i(81520),h=e.i(60103),v=e.i(47716),A=e.i(23089),p=e.i(2079),g=e.i(80085);let S=[{id:0,image:_,name:"summer",prompt:"Girl cannot choose between two men. She is in love with both and looks at both..."},{id:1,image:m,name:"adventure",prompt:"The princess says the castle is in danger! She points at the castle"}];function b(e){let a,o,n,s,m,_,b,N,y,I,x,w,j,B,C,O,E,G,V,D,M,q,k,T,U,F,R,Q,P=(0,t.c)(78),{disabled:L,handleSubmitGame:W,handleNewVideoAssetCreation:K,handleNewImageAssetCreation:H,submitPromptAndBase64Image:z,projectId:Y}=e,[Z,J]=(0,l.useState)(!1),[$,X]=(0,l.useState)(S[0].prompt),[ee,et]=(0,l.useState)(0),{setOpen:ea,setContent:el}=(0,p.useDialog)(),eo=(0,u.useAddAssetToProjectMutation)();P[0]!==H||P[1]!==K||P[2]!==$?(a=async(e,t)=>{let a=t.blob;a.type.includes("video/")&&await K(e),a.type.includes("image/")&&await H(e,$)},P[0]=H,P[1]=K,P[2]=$,P[3]=a):a=P[3],P[4]!==eo||P[5]!==Y?(o=e=>{J(!1),e&&eo.mutate({projectId:Y,assetId:e.id})},P[4]=eo,P[5]=Y,P[6]=o):o=P[6],P[7]!==a||P[8]!==o?(n={onAssetUploaded:a,onSettled:o},P[7]=a,P[8]=o,P[9]=n):n=P[9];let en=(0,u.useUploadAssetMutation)(n);P[10]!==en||P[11]!==el||P[12]!==ea?(s=function(e){if(e.size>0x1300000){ea(!0),el({title:"Error",body:"File exceeds maximum allowed size."});return}J(!0),en.mutate({blob:e,description:e.name})},P[10]=en,P[11]=el,P[12]=ea,P[13]=s):s=P[13];let es=s;P[14]!==es||P[15]!==el||P[16]!==ea?(m=function(e){if(e[0].type.includes("image/")){ea(!0),el({title:"Error",body:"This drop area only accepts videos."});return}es(e[0])},P[14]=es,P[15]=el,P[16]=ea,P[17]=m):m=P[17];let ei=m;P[18]!==es||P[19]!==el||P[20]!==ea?(_=function(e){if(e.type.includes("video/")){ea(!0),el({title:"Error",body:"This drop area only accepts videos."});return}es(e)},P[18]=es,P[19]=el,P[20]=ea,P[21]=_):_=P[21];let er=_;P[22]!==ee||P[23]!==W||P[24]!==$||P[25]!==z?(b=async function(e){(0,c.logEventVideoImagesCreate)(),J(!0);let t=null!==ee?S.find(e=>e.id===ee):null;if(!t)return void W(e);let a=await fetch(t.image.src),l=await a.blob();z($,await new Promise(e=>{let t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(l)}))},P[22]=ee,P[23]=W,P[24]=$,P[25]=z,P[26]=b):b=P[26];let ed=b;P[27]===Symbol.for("react.memo_cache_sentinel")?(N=function(e){X(e),""===e&&et(null)},P[27]=N):N=P[27];let eu=N;P[28]===Symbol.for("react.memo_cache_sentinel")?(y=function(e){et(e.id),X(e.prompt)},P[28]=y):y=P[28];let ec=y,em=$.length>0&&!L&&!Z,e_=!em||null!==ee;P[29]===Symbol.for("react.memo_cache_sentinel")?(I=(0,i.jsx)("h2",{children:"Step 1"}),P[29]=I):I=P[29],P[30]!==ee?(x=S.map((e,t)=>(0,i.jsx)("div",{className:(0,r.default)(g.default.Tab,t!==ee?g.default.Inactive:void 0),onClick:()=>ec(e),children:(0,i.jsx)(d.default,{className:t!==ee?g.default.Inactive:void 0,alt:e.name,src:e.image,width:256,height:256})},`${e.name}-${t}`)),P[30]=ee,P[31]=x):x=P[31],P[32]!==x?(w=(0,i.jsxs)("header",{children:[I,x]}),P[32]=x,P[33]=w):w=P[33],P[34]===Symbol.for("react.memo_cache_sentinel")?(j=(0,i.jsx)("p",{children:"Describe your game or upload a starting video"}),P[34]=j):j=P[34],P[35]!==ed||P[36]!==$?(B=e=>"Enter"===e.key&&void ed($.trim()),P[35]=ed,P[36]=$,P[37]=B):B=P[37],P[38]===Symbol.for("react.memo_cache_sentinel")?(C=e=>eu(e.target.value),P[38]=C):C=P[38],P[39]!==L||P[40]!==$||P[41]!==B?(O=(0,i.jsx)("textarea",{placeholder:"Enter your game idea here","aria-label":"Game idea input",autoFocus:!0,maxLength:100,rows:5,disabled:L,onKeyDown:B,onChange:C,value:$}),P[39]=L,P[40]=$,P[41]=B,P[42]=O):O=P[42];let ef=750*!e_,eh=e_?null!==ee?"Cannot upload image with template":"A prompt is needed to start from an image":void 0;P[43]!==e_||P[44]!==er||P[45]!==ef||P[46]!==eh?(E=(0,i.jsx)(v.AttachPromptImageButton,{disabled:e_,onFileSubmit:er,className:g.default.UploadImageButton,tooltipDelay:ef,tooltipText:eh}),P[43]=e_,P[44]=er,P[45]=ef,P[46]=eh,P[47]=E):E=P[47];let ev=!em;return P[48]!==ed||P[49]!==$?(G=()=>void ed($.trim()),P[48]=ed,P[49]=$,P[50]=G):G=P[50],P[51]===Symbol.for("react.memo_cache_sentinel")?(V=(0,i.jsx)(A.ArrowRight,{}),P[51]=V):V=P[51],P[52]!==ev||P[53]!==G?(D=(0,i.jsx)("button",{className:g.default.SubmitButton,type:"submit",disabled:ev,onClick:G,children:V}),P[52]=ev,P[53]=G,P[54]=D):D=P[54],P[55]!==E||P[56]!==D?(M=(0,i.jsxs)("div",{className:g.default.PromptAreaBottomBar,children:[E,D]}),P[55]=E,P[56]=D,P[57]=M):M=P[57],P[58]!==O||P[59]!==M?(q=(0,i.jsxs)("section",{children:[O,M]}),P[58]=O,P[59]=M,P[60]=q):q=P[60],P[61]===Symbol.for("react.memo_cache_sentinel")?(k=(0,i.jsx)("span",{children:"Or"}),P[61]=k):k=P[61],P[62]!==L||P[63]!==$.length?(T=(0,i.jsx)("section",{className:g.default.DragDropContent,children:$.length>0&&!L?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("aside",{}),(0,i.jsx)("p",{children:"Cannot upload a video with a prompt"}),(0,i.jsx)("p",{children:"Delete your game description to upload a video"})]}):(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("section",{children:[(0,i.jsx)("p",{children:"Drag and drop Video"}),(0,i.jsx)("p",{children:"or"}),(0,i.jsx)("span",{className:"upload-button",children:"Browse for Asset"}),(0,i.jsxs)("p",{children:["Files must be under ",(0,i.jsx)("strong",{children:"19MB"})]})]})})}),P[62]=L,P[63]=$.length,P[64]=T):T=P[64],P[65]!==L||P[66]!==ei||P[67]!==T?(U=(0,i.jsx)(f.default,{onSubmit:ei,isDisabled:L,className:g.default.DragDropWrapper,children:T}),P[65]=L,P[66]=ei,P[67]=T,P[68]=U):U=P[68],P[69]!==q||P[70]!==U?(F=(0,i.jsxs)("div",{className:g.default.CreationSection,children:[j,q,k,U]}),P[69]=q,P[70]=U,P[71]=F):F=P[71],P[72]!==Z?(R=Z&&(0,i.jsxs)("div",{className:g.default.LoadingOverlay,children:[(0,i.jsx)(h.default,{}),(0,i.jsx)("h2",{children:"Working, please wait!"})]}),P[72]=Z,P[73]=R):R=P[73],P[74]!==w||P[75]!==F||P[76]!==R?(Q=(0,i.jsxs)("div",{className:g.default.InitialCreator,children:[w,F,R]}),P[74]=w,P[75]=F,P[76]=R,P[77]=Q):Q=P[77],Q}e.s(["default",()=>b],16533)},6801,e=>{"use strict";e.s(["useActiveNode",()=>b,"useNextNodes",()=>I,"useVideoGenActions",()=>x,"useVideoGenBreadcrumbs",()=>w,"useVideoGenData",()=>f]);var t=e.i(932),a=e.i(12598),l=e.i(54452),o=e.i(71645),n=e.i(68834),s=e.i(92599),i=e.i(55689),r=e.i(27030),d=e.i(73776);e.i(80380);var u=e.i(14978),c=e.i(47516);let m=(e,t,a,l)=>{if(!e||!t||e.label===t.label)return null;let o=l.find((t,l)=>a[l].label===e.label);if(!o)return null;let n=o.name.replace(".json","");return a.find(e=>e.choices.some(e=>e.target===n))||null},_=(0,n.create)(e=>({activeNodeFilename:"intro.json",setActiveNodeFilename:t=>e({activeNodeFilename:t})}));function f(){let e,a,o,n,i,r,d,c=(0,t.c)(20),{activeRevision:m}=(0,u.default)();c[0]!==m.id?(e={queryKey:["files",{revision:m.id}],queryFn:()=>(0,s.getAllGenericFiles)({revision:m.id}),select:g},c[0]=m.id,c[1]=e):e=c[1];let{data:_}=(0,l.useSuspenseQuery)(e),f=m.id;c[2]!==_?(a=_.map(p),c[2]=_,c[3]=a):a=c[3],c[4]!==m.id||c[5]!==a?(o=["videoGenNodes",{revision:f,files:a}],c[4]=m.id,c[5]=a,c[6]=o):o=c[6],c[7]!==_?(n=async()=>{let e=_.map(A),t=await Promise.allSettled(e),a=[];for(let e of t)"fulfilled"===e.status?a.push(e.value):console.error("Parsing json failed:",e.reason);return{jsonGenericFiles:a.map(v),jsonNodes:a.map(h)}},c[7]=_,c[8]=n):n=c[8],c[9]!==o||c[10]!==n?(i={queryKey:o,queryFn:n},c[9]=o,c[10]=n,c[11]=i):i=c[11];let{data:S}=(0,l.useSuspenseQuery)(i),{jsonGenericFiles:b,jsonNodes:N}=S;c[12]!==b||c[13]!==N?(r=N.find((e,t)=>"intro.json"===b[t].name)||N[0],c[12]=b,c[13]=N,c[14]=r):r=c[14];let y=r,I=1===_.length&&"intro.json"===_[0].name&&null===N[0].video;return c[15]!==y||c[16]!==I||c[17]!==b||c[18]!==N?(d={jsonGenericFiles:b,jsonNodes:N,introNode:y,isNewProject:I},c[15]=y,c[16]=I,c[17]=b,c[18]=N,c[19]=d):d=c[19],d}function h(e){return e.node}function v(e){return e.genericfile}async function A(e){let t=await (0,s.getGenericFile)(e.id),a=JSON.parse(t.content);return{genericfile:t,node:a}}function p(e){return e.id}function g(e){return e.filter(S)}function S(e){return e.path===c.DATA_FOLDER&&e.name.includes(".json")}function b(){let e,a,l,o=(0,t.c)(7),{jsonNodes:n,jsonGenericFiles:s,introNode:i}=f(),r=_(y),d=_(N);e:{if(!r){e=i;break e}let t=s.findIndex(e=>e.name===r);if(-1===t){e=i;break e}e=n[t]||i}let u=e;o[0]!==s||o[1]!==n||o[2]!==d?(a=e=>{if(!e)return void d("intro.json");let t=n.findIndex(t=>t.label===e.label);-1!==t&&d(s[t].name)},o[0]=s,o[1]=n,o[2]=d,o[3]=a):a=o[3];let c=a;return o[4]!==u||o[5]!==c?(l={activeNode:u,setActiveNode:c},o[4]=u,o[5]=c,o[6]=l):l=o[6],l}function N(e){return e.setActiveNodeFilename}function y(e){return e.activeNodeFilename}function I(){let e,a=(0,t.c)(8),{activeNode:l}=b(),{jsonNodes:o,jsonGenericFiles:n}=f();if(!l){let e;return a[0]===Symbol.for("react.memo_cache_sentinel")?(e=[],a[0]=e):e=a[0],e}if(a[1]!==l.choices||a[2]!==n||a[3]!==o){let t;a[5]!==n||a[6]!==o?(t=e=>{let t=o.find((t,a)=>n[a].name===e.target+".json");return t?[t]:[]},a[5]=n,a[6]=o,a[7]=t):t=a[7],e=l.choices.flatMap(t),a[1]=l.choices,a[2]=n,a[3]=o,a[4]=e}else e=a[4];return e}function x(){let{activeRevision:e,project:t,handleNewRevision:l}=(0,u.default)(),{mutateAsync:n}=(0,i.useCopyRevision)({projectId:t.id}),{mutateAsync:m}=(0,i.useCreateFile)(),_=(0,a.useQueryClient)(),{jsonNodes:h,jsonGenericFiles:v}=f(),{activeNode:A}=b();async function p(e,a){let o=_.getQueryData(["projects",t.id]);if(!o)return;let i=o.current_revision_id,r=_.getQueryData(["files",{revision:i}]);if(!r)return;let d=r.filter(e=>e.path===c.DATA_FOLDER&&e.name.includes(".json")).find(t=>t.name.replace(".json","")===e);if(!d)return;let u={...JSON.parse((await (0,s.getGenericFile)(d.id)).content),video:a.media_file.blob},m=await n({revision_id:i,label:`Added video to ${d.name}`,overwrite_files:[{id:d.id,content:JSON.stringify(u,null,2)}]});await _.invalidateQueries({queryKey:["files",{revision:i}]}),await l(m.id)}(0,d.useVideoGenerationCompleteEventEmitter)(e=>{p(e.nodeLabel,e.asset)});let g=(0,o.useCallback)(async(e,a)=>{let o=_.getQueryData(["projects",t.id]);if(!o)return;let s=o.current_revision_id,i=v.find((t,a)=>h[a].label===e.label);if(!i)return;let r=await n({revision_id:s,label:`Saved ${i.name} changes`,overwrite_files:[{id:i.id,content:JSON.stringify(a,null,2)}]});await _.invalidateQueries({queryKey:["files",{revision:s}]}),await l(r.id)},[t.id,n,l,v,h,_]),S=(0,o.useCallback)(async(t,a)=>{let l=`${a}.json`;if(v.some(e=>e.name===l))return(0,r.failure)("File with that name already exists!");await m({name:l,path:c.DATA_FOLDER,content:JSON.stringify(t,null,2),revision:e.id,permissions:"r",in_llm_context:!1,metadata:{}});let o={...A,choices:[...A.choices,{target:a}]};return await g(A,o),(0,r.success)()},[A,m,e.id,v,g]);return{saveNode:g,saveNewChildNode:S,deleteNode:(0,o.useCallback)(async t=>{if(e)try{let a=v.find((e,a)=>h[a].label===t.label);if(!a)return;let o=[];v.forEach((e,t)=>{let l=h[t];if(e.id===a.id)return;let n=a.name.replace(".json","");if(l.choices.some(e=>e.target===n)){let t={...l,choices:l.choices.filter(e=>e.target!==n)};o.push({id:e.id,content:JSON.stringify(t,null,2)})}});let s=await n({revision_id:e.id,label:`Deleted ${a.name}`,overwrite_files:o,exclude_files:[a.id]});await l(s.id),await _.invalidateQueries({queryKey:["files"]}),await _.invalidateQueries({queryKey:["videoGenNodes"]}),await _.invalidateQueries({queryKey:["revisions"]})}catch(e){console.error("Failed to delete node:",e)}},[e,n,l,v,h,_])}}function w(){let e,a,l=(0,t.c)(8),{jsonNodes:o,jsonGenericFiles:n,introNode:s}=f(),{activeNode:i}=b();e:{let t;if(!i){let t;l[0]===Symbol.for("react.memo_cache_sentinel")?(t=[],l[0]=t):t=l[0],e=t;break e}if(l[1]!==i||l[2]!==s||l[3]!==n||l[4]!==o){t=[];let e=i;for(;e;){let a=m(e,s,o,n);a&&t.unshift(a),e=a}l[1]=i,l[2]=s,l[3]=n,l[4]=o,l[5]=t}else t=l[5];e=t}let r=e;return l[6]!==r?(a={breadcrumbs:r},l[6]=r,l[7]=a):a=l[7],a}},45467,e=>{e.v({SelectContent:"UnstyledSelect-module-scss-module__FTo3Nq__SelectContent",SelectGroup:"UnstyledSelect-module-scss-module__FTo3Nq__SelectGroup",SelectIcon:"UnstyledSelect-module-scss-module__FTo3Nq__SelectIcon",SelectItem:"UnstyledSelect-module-scss-module__FTo3Nq__SelectItem",SelectItemIcon:"UnstyledSelect-module-scss-module__FTo3Nq__SelectItemIcon",SelectTrigger:"UnstyledSelect-module-scss-module__FTo3Nq__SelectTrigger",SelectValue:"UnstyledSelect-module-scss-module__FTo3Nq__SelectValue",SelectValueIcon:"UnstyledSelect-module-scss-module__FTo3Nq__SelectValueIcon",fadeAndScaleIn:"UnstyledSelect-module-scss-module__FTo3Nq__fadeAndScaleIn",fadeAndScaleOut:"UnstyledSelect-module-scss-module__FTo3Nq__fadeAndScaleOut",pulseBackground:"UnstyledSelect-module-scss-module__FTo3Nq__pulseBackground",scaleIn:"UnstyledSelect-module-scss-module__FTo3Nq__scaleIn",scaleOut:"UnstyledSelect-module-scss-module__FTo3Nq__scaleOut"})},54481,e=>{e.v({ModelSelector:"VideoGenModelSelector-module-scss-module__cNlOva__ModelSelector",SelectContent:"VideoGenModelSelector-module-scss-module__cNlOva__SelectContent",SelectGroup:"VideoGenModelSelector-module-scss-module__cNlOva__SelectGroup",SelectIcon:"VideoGenModelSelector-module-scss-module__cNlOva__SelectIcon",SelectItem:"VideoGenModelSelector-module-scss-module__cNlOva__SelectItem",SelectItemIcon:"VideoGenModelSelector-module-scss-module__cNlOva__SelectItemIcon",fadeAndScaleIn:"VideoGenModelSelector-module-scss-module__cNlOva__fadeAndScaleIn",fadeAndScaleOut:"VideoGenModelSelector-module-scss-module__cNlOva__fadeAndScaleOut",pulseBackground:"VideoGenModelSelector-module-scss-module__cNlOva__pulseBackground",scaleIn:"VideoGenModelSelector-module-scss-module__cNlOva__scaleIn",scaleOut:"VideoGenModelSelector-module-scss-module__cNlOva__scaleOut"})},91803,e=>{e.v({Hidden:"NodeEditor-module-scss-module__d4fBOW__Hidden",ImageContainer:"NodeEditor-module-scss-module__d4fBOW__ImageContainer",LoadingSpinner:"NodeEditor-module-scss-module__d4fBOW__LoadingSpinner",NextNodes:"NodeEditor-module-scss-module__d4fBOW__NextNodes",NodeEditor:"NodeEditor-module-scss-module__d4fBOW__NodeEditor",PreviewImageBackground:"NodeEditor-module-scss-module__d4fBOW__PreviewImageBackground",TrashContainer:"NodeEditor-module-scss-module__d4fBOW__TrashContainer",VideoPreview:"NodeEditor-module-scss-module__d4fBOW__VideoPreview",fadeAndScaleIn:"NodeEditor-module-scss-module__d4fBOW__fadeAndScaleIn",fadeAndScaleOut:"NodeEditor-module-scss-module__d4fBOW__fadeAndScaleOut",pulseBackground:"NodeEditor-module-scss-module__d4fBOW__pulseBackground",scaleIn:"NodeEditor-module-scss-module__d4fBOW__scaleIn",scaleOut:"NodeEditor-module-scss-module__d4fBOW__scaleOut"})},94672,e=>{e.v({ChangeActiveNodeButton:"NextNodeButton-module-scss-module__Q_PlUq__ChangeActiveNodeButton",DeleteNodeButton:"NextNodeButton-module-scss-module__Q_PlUq__DeleteNodeButton",Deleting:"NextNodeButton-module-scss-module__Q_PlUq__Deleting",EnterNodeButton:"NextNodeButton-module-scss-module__Q_PlUq__EnterNodeButton",fadeAndScaleIn:"NextNodeButton-module-scss-module__Q_PlUq__fadeAndScaleIn",fadeAndScaleOut:"NextNodeButton-module-scss-module__Q_PlUq__fadeAndScaleOut",pulseBackground:"NextNodeButton-module-scss-module__Q_PlUq__pulseBackground",scaleIn:"NextNodeButton-module-scss-module__Q_PlUq__scaleIn",scaleOut:"NextNodeButton-module-scss-module__Q_PlUq__scaleOut"})},53229,e=>{e.v({InputBottomBar:"NewNodeInput-module-scss-module__ZsaM5G__InputBottomBar",LeftButtons:"NewNodeInput-module-scss-module__ZsaM5G__LeftButtons",NewNodeButtonContainer:"NewNodeInput-module-scss-module__ZsaM5G__NewNodeButtonContainer",SubmitButton:"NewNodeInput-module-scss-module__ZsaM5G__SubmitButton",fadeAndScaleIn:"NewNodeInput-module-scss-module__ZsaM5G__fadeAndScaleIn",fadeAndScaleOut:"NewNodeInput-module-scss-module__ZsaM5G__fadeAndScaleOut",pulseBackground:"NewNodeInput-module-scss-module__ZsaM5G__pulseBackground",scaleIn:"NewNodeInput-module-scss-module__ZsaM5G__scaleIn",scaleOut:"NewNodeInput-module-scss-module__ZsaM5G__scaleOut"})},68263,e=>{e.v({EditButton:"NodeLabel-module-scss-module__8vNcsW__EditButton",LabelContainer:"NodeLabel-module-scss-module__8vNcsW__LabelContainer",LabelEditor:"NodeLabel-module-scss-module__8vNcsW__LabelEditor",fadeAndScaleIn:"NodeLabel-module-scss-module__8vNcsW__fadeAndScaleIn",fadeAndScaleOut:"NodeLabel-module-scss-module__8vNcsW__fadeAndScaleOut",pulseBackground:"NodeLabel-module-scss-module__8vNcsW__pulseBackground",scaleIn:"NodeLabel-module-scss-module__8vNcsW__scaleIn",scaleOut:"NodeLabel-module-scss-module__8vNcsW__scaleOut"})},73818,e=>{e.v({DragDropText:"NodeEditorRegenerateInput-module-scss-module__5QOphq__DragDropText",Uploading:"NodeEditorRegenerateInput-module-scss-module__5QOphq__Uploading",fadeAndScaleIn:"NodeEditorRegenerateInput-module-scss-module__5QOphq__fadeAndScaleIn",fadeAndScaleOut:"NodeEditorRegenerateInput-module-scss-module__5QOphq__fadeAndScaleOut",pulseBackground:"NodeEditorRegenerateInput-module-scss-module__5QOphq__pulseBackground",scaleIn:"NodeEditorRegenerateInput-module-scss-module__5QOphq__scaleIn",scaleOut:"NodeEditorRegenerateInput-module-scss-module__5QOphq__scaleOut"})},21514,39809,e=>{"use strict";e.s(["default",()=>j],21514);var t=e.i(18050),a=e.i(932),l=e.i(12598),o=e.i(57688),n=e.i(71645),s=e.i(55689),i=e.i(72783),r=e.i(60103);e.i(80380);var d=e.i(14978),u=e.i(47931),c=e.i(16533),m=e.i(6801),_=e.i(68834),f=e.i(79473),h=e.i(29011),v=e.i(7670),A=e.i(1697),p=e.i(45467);function g(e){let l,o,n,s,i,r,d,u,c,m,_=(0,a.c)(32),{value:f,options:h,onChange:g,disabled:S,align:b,classNames:N}=e,y=void 0!==S&&S,I=void 0===b?"start":b,x=N?.trigger;_[0]!==x?(l=(0,v.default)(p.default.SelectTrigger,x),_[0]=x,_[1]=l):l=_[1];let w=N?.value;_[2]!==w?(o=(0,v.default)(p.default.SelectValue,w),_[2]=w,_[3]=o):o=_[3];let j=N?.valueIcon;_[4]!==j?(n=(0,v.default)(p.default.SelectValueIcon,j),_[4]=j,_[5]=n):n=_[5];let B=N?.icon;_[6]!==B?(s=(0,v.default)(p.default.SelectIcon,B),_[6]=B,_[7]=s):s=_[7];let C=N?.content;_[8]!==C?(i=(0,v.default)(p.default.SelectContent,C),_[8]=C,_[9]=i):i=_[9];let O=N?.group;_[10]!==O?(r=(0,v.default)(p.default.SelectGroup,O),_[10]=O,_[11]=r):r=_[11];let E=N?.item;_[12]!==E?(d=(0,v.default)(p.default.SelectItem,E),_[12]=E,_[13]=d):d=_[13];let G=N?.itemIcon;return _[14]!==G?(u=(0,v.default)(p.default.SelectItemIcon,G),_[14]=G,_[15]=u):u=_[15],_[16]!==s||_[17]!==i||_[18]!==r||_[19]!==d||_[20]!==u||_[21]!==l||_[22]!==o||_[23]!==n?(c={trigger:l,value:o,valueIcon:n,icon:s,content:i,group:r,item:d,itemIcon:u},_[16]=s,_[17]=i,_[18]=r,_[19]=d,_[20]=u,_[21]=l,_[22]=o,_[23]=n,_[24]=c):c=_[24],_[25]!==I||_[26]!==y||_[27]!==g||_[28]!==h||_[29]!==c||_[30]!==f?(m=(0,t.jsx)(A.BaseSelect,{value:f,options:h,onChange:g,disabled:y,align:I,classNames:c}),_[25]=I,_[26]=y,_[27]=g,_[28]=h,_[29]=c,_[30]=f,_[31]=m):m=_[31],m}var S=e.i(54481);let b=Object.keys(h.VideoModelCosts);function N(e){let l,o,s,i,r,d=(0,a.c)(8),{disabled:u}=e,c=void 0!==u&&u,{activeVideoModel:m,setActiveVideoModel:_}=w();d[0]===Symbol.for("react.memo_cache_sentinel")?(l=[],d[0]=l):l=d[0],(0,n.useEffect)(I,l),d[1]===Symbol.for("react.memo_cache_sentinel")?(o=function(){return b.reduce(y,{})},d[1]=o):o=d[1];let f=o;return d[2]===Symbol.for("react.memo_cache_sentinel")?(s={trigger:S.default.ModelSelector,content:S.default.SelectContent,group:S.default.SelectGroup,item:S.default.SelectItem},d[2]=s):s=d[2],d[3]===Symbol.for("react.memo_cache_sentinel")?(i=f(),d[3]=i):i=d[3],d[4]!==m||d[5]!==c||d[6]!==_?(r=(0,t.jsx)(g,{classNames:s,value:m,options:i,onChange:_,disabled:c}),d[4]=m,d[5]=c,d[6]=_,d[7]=r):r=d[7],r}function y(e,t){return e[t]={label:`${t} - ${h.VideoModelCosts[t].toLocaleString("en-US")}`},e}function I(){return window.addEventListener("storage",x),()=>{window.removeEventListener("storage",x)}}function x(e){e.key===w.persist.getOptions().name&&w.persist.rehydrate()}let w=(0,_.create)()((0,f.persist)(e=>({activeVideoModel:"Seedance Pro",setActiveVideoModel:t=>e({activeVideoModel:t})}),{version:JSON.stringify(h.VideoModelCosts).length,name:"video-model-choice-storage",migrate:()=>({activeLlmModel:"Seedance Pro"})}));function j(){let e,_,f,h,v,A=(0,a.c)(9),[p,g]=(0,n.useState)(!1);A[0]===Symbol.for("react.memo_cache_sentinel")?(e=[],A[0]=e):e=A[0];let[S,b]=(0,n.useState)(e),[N,y]=(0,n.useState)(),{project:I}=(0,d.default)(),x=(0,n.useRef)(""),j=(0,l.useQueryClient)(),B=(0,s.useRenameProjectWithGeneratedName)(),{introNode:C}=(0,m.useVideoGenData)(),{saveNode:O}=(0,m.useVideoGenActions)(),{activeVideoModel:E}=w();A[1]!==j?(_=()=>{j.invalidateQueries({queryKey:["assets"]}),j.invalidateQueries({queryKey:["projects"]}),g(!1)},A[1]=j,A[2]=_):_=A[2];let G=(0,s.useGenerateVideoMutation)({onSuccess:async e=>{j.invalidateQueries({queryKey:["projects",I.id]}),j.invalidateQueries({queryKey:["assets",e.id]}),await D(e)},onSettled:_});A[3]===Symbol.for("react.memo_cache_sentinel")?(f=()=>{g(!0)},A[3]=f):f=A[3],A[4]!==j?(h=()=>{g(!1),j.invalidateQueries({queryKey:["assets"]}),j.invalidateQueries({queryKey:["projects"]})},A[4]=j,A[5]=h):h=A[5];let V=(0,s.useGenerateAssetMutation)({onMutate:f,onSuccess:e=>{M(e,x.current),j.invalidateQueries({queryKey:["projects",I.id]}),j.invalidateQueries({queryKey:["assets",e.id]})},onSettled:h});async function D(e){await U(e)}function M(e,t){b(t=>[...t,e]),x.current=t}let q=async function(e){y(e),await k(e.media_file.blob)};async function k(e){g(!0),(0,i.logEventVideoCreateIntro)();let t=await fetch(e),a=await t.blob();T(await new Promise((e,t)=>{let l=new FileReader;l.onloadend=()=>{e(l.result)},l.onerror=e=>{console.error(e),t(Error("Failed to extend video"))},l.readAsDataURL(a)}))}function T(e){G.mutate({nodeToUpdate:{...C},apiData:{text:x.current,input_image:e,video_model:E}}),B.mutate({projectId:I.id,text:x.current})}async function U(e){await O(C,{...C,video:e.media_file.blob,label:x.current})}let F=u.default,R=0===S.length?(0,t.jsx)(c.default,{disabled:p,handleSubmitGame:function(e){for(let t=0;t<4;t++)V.mutate({text:e,model_name:"FluxPro",prompt_expansion:!0});x.current=e},handleNewVideoAssetCreation:D,handleNewImageAssetCreation:M,submitPromptAndBase64Image:function(e,t){x.current=e,T(t)},projectId:I.id}):N?(0,t.jsxs)("div",{className:u.default.PreviewImageContainer,children:[(0,t.jsx)(o.default,{alt:N.name,src:N.media_file.blob,width:512,height:512}),(0,t.jsx)("div",{className:u.default.PreviewImageBackground}),(0,t.jsxs)("div",{className:u.default.LoadingSpinner,children:[(0,t.jsx)(r.default,{}),(0,t.jsx)("p",{children:"Generating video..."})]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:"What kind of game would you like? Pick one"}),(0,t.jsx)("ul",{className:u.default.ImagesContainer,children:S.map(e=>(0,t.jsx)("li",{children:(0,t.jsx)("button",{onClick:()=>void q(e),disabled:p,children:(0,t.jsx)(o.default,{alt:e.name,src:e.media_file.blob,width:512,height:512})})},e.id))})]});return A[6]!==F.IntroWrapper||A[7]!==R?(v=(0,t.jsx)("div",{className:F.IntroWrapper,children:R}),A[6]=F.IntroWrapper,A[7]=R,A[8]=v):v=A[8],v}e.s(["default",()=>$],39809);var B=e.i(30735),C=e.i(91803),O=e.i(36382),E=e.i(94672);function G(e){let l,o,i,d,u,c,_,f,h,A,p,g,S=(0,a.c)(32),{node:b}=e,[N,y]=(0,n.useState)(!1),{deleteNode:I}=(0,m.useVideoGenActions)(),{setActiveNode:x}=(0,m.useActiveNode)();S[0]===Symbol.for("react.memo_cache_sentinel")?(l={mutationKey:s.VIDEO_MUTATION_KEY,status:"pending"},S[0]=l):l=S[0],S[1]!==b.label?(o={filters:l,select:e=>{if("pending"!==e.state.status)return!1;let t=e.state.variables;return t?.nodeToUpdate.label===b.label}},S[1]=b.label,S[2]=o):o=S[2];let w=(0,O.useMutationState)(o);S[3]!==I?(i=async function(e){y(!0),await I(e),setTimeout(()=>y(!1),100)},S[3]=I,S[4]=i):i=S[4];let j=i;S[5]!==w?(d=w.some(Boolean),S[5]=w,S[6]=d):d=S[6];let C=d,G=null===b.video&&!b.image,V=!C&&G,D=V?`Failed: ${b.label}`:G?`Generating: ${b.label}`:b.label,M=G||N,q=M&&!V||N,k=M&&E.default.Deleting;S[7]!==k?(u=(0,v.default)(E.default.ChangeActiveNodeButton,k),S[7]=k,S[8]=u):u=S[8],S[9]!==b||S[10]!==x?(c=()=>x(b),S[9]=b,S[10]=x,S[11]=c):c=S[11],S[12]!==D?(_=(0,t.jsx)("span",{children:D}),S[12]=D,S[13]=_):_=S[13],S[14]!==M||S[15]!==c||S[16]!==_?(f=(0,t.jsx)("button",{onClick:c,className:E.default.EnterNodeButton,disabled:M,children:_}),S[14]=M,S[15]=c,S[16]=_,S[17]=f):f=S[17],S[18]!==j||S[19]!==b?(h=()=>void j(b),S[18]=j,S[19]=b,S[20]=h):h=S[20];let T=N?"Deleting...":`Delete ${b.label}`;return S[21]!==q?(A=q?(0,t.jsx)(r.default,{}):(0,t.jsx)(B.default,{}),S[21]=q,S[22]=A):A=S[22],S[23]!==q||S[24]!==h||S[25]!==T||S[26]!==A?(p=(0,t.jsx)("button",{className:E.default.DeleteNodeButton,onClick:h,disabled:q,"aria-label":T,children:A}),S[23]=q,S[24]=h,S[25]=T,S[26]=A,S[27]=p):p=S[27],S[28]!==p||S[29]!==u||S[30]!==f?(g=(0,t.jsxs)("div",{className:u,children:[f,p]}),S[28]=p,S[29]=u,S[30]=f,S[31]=g):g=S[31],g}var V=e.i(47716),D=e.i(2079),M=e.i(53229);function q(e){let o,i,r,u,c,m,_,f=(0,a.c)(24),{addNewNode:h}=e,[v,A]=(0,n.useState)(""),{project:p}=(0,d.default)(),g=(0,l.useQueryClient)(),[S,b]=(0,n.useState)(!1),{setOpen:N,setContent:y}=(0,D.useDialog)();f[0]!==g?(o={onSettled:()=>{g.invalidateQueries({queryKey:["assets"]}),g.invalidateQueries({queryKey:["projects"]})}},f[0]=g,f[1]=o):o=f[1];let I=(0,s.useUploadAssetMutation)(o),x=(0,s.useAddAssetToProjectMutation)();f[2]===Symbol.for("react.memo_cache_sentinel")?(i=function(e){A(e.target.value)},f[2]=i):i=f[2];let w=i;f[3]!==x||f[4]!==h||f[5]!==I||f[6]!==v||f[7]!==p.id||f[8]!==y||f[9]!==N?(r=async function(e){b(!0);let t=await I.mutateAsync({blob:e,description:e.name});await x.mutateAsync({projectId:p.id,assetId:t.id});let a=v.trim(),l=await h(a,t.media_file.blob);if("error"===l.status){b(!1),y({title:"Error",body:l.error}),N(!0);return}b(!1)},f[3]=x,f[4]=h,f[5]=I,f[6]=v,f[7]=p.id,f[8]=y,f[9]=N,f[10]=r):r=f[10];let j=r;f[11]!==v||f[12]!==S?(u=S||""===v.trim(),f[11]=v,f[12]=S,f[13]=u):u=f[13];let B=u;f[14]!==v||f[15]!==S?(c=(0,t.jsx)("textarea",{value:v,onChange:w,disabled:S}),f[14]=v,f[15]=S,f[16]=c):c=f[16];let C=B?"Describe next scene before uploading":"Upload Image";return f[17]!==j||f[18]!==B||f[19]!==C?(m=(0,t.jsx)("div",{className:M.default.InputBottomBar,children:(0,t.jsx)("div",{className:M.default.LeftButtons,children:(0,t.jsx)(V.AttachPromptImageButton,{disabled:B,onFileSubmit:j,tooltipText:C})})}),f[17]=j,f[18]=B,f[19]=C,f[20]=m):m=f[20],f[21]!==c||f[22]!==m?(_=(0,t.jsxs)("div",{className:M.default.NewNodeButtonContainer,children:[c,m]}),f[21]=c,f[22]=m,f[23]=_):_=f[23],_}async function k(e){var t;let a=new OffscreenCanvas(e.videoWidth,e.videoHeight),l=a.getContext("2d");if(!l)throw Error("Could not get 2D context from OffscreenCanvas");let o=e.currentTime,n=new Promise(t=>{let a=()=>{e.removeEventListener("seeked",a),t()};e.addEventListener("seeked",a)});e.currentTime=e.duration-.01,await n,l.drawImage(e,0,0,e.videoWidth,e.videoHeight);let s=await a.convertToBlob({type:"image/png"});return e.currentTime=o,await (t=s,new Promise(e=>{let a=new FileReader;a.onload=()=>e(a.result),a.readAsDataURL(t)}))}var T=e.i(23089);function U(e){let o,r,u,c,m,_,f,h,v,A,p,g,S,b,y,I,x,j,B=(0,a.c)(56),{addNewNode:C,videoElement:O}=e,[E,G]=(0,n.useState)(""),{project:q}=(0,d.default)(),U=(0,l.useQueryClient)(),[F,R]=(0,n.useState)(!1),[Q,P]=(0,n.useState)(void 0),{activeVideoModel:L}=w(),{setOpen:W,setContent:K}=(0,D.useDialog)();B[0]!==U?(o={onSettled:()=>{U.invalidateQueries({queryKey:["assets"]}),U.invalidateQueries({queryKey:["projects"]})}},B[0]=U,B[1]=o):o=B[1];let H=(0,s.useUploadAssetMutation)(o),z=(0,s.useAddAssetToProjectMutation)();B[2]!==z||B[3]!==q.id||B[4]!==U?(r=async e=>{await z.mutateAsync({projectId:q.id,assetId:e.id}),U.invalidateQueries({queryKey:["projects",q.id]}),U.invalidateQueries({queryKey:["assets",e.id]}),R(!1)},B[2]=z,B[3]=q.id,B[4]=U,B[5]=r):r=B[5],B[6]!==U?(u=()=>{U.invalidateQueries({queryKey:["assets"]}),U.invalidateQueries({queryKey:["projects"]})},B[6]=U,B[7]=u):u=B[7],B[8]!==r||B[9]!==u?(c={onSuccess:r,onSettled:u},B[8]=r,B[9]=u,B[10]=c):c=B[10];let Y=(0,s.useGenerateVideoMutation)(c);B[11]!==O?(m=()=>{let e=async function(e){P({base64:await k(O),width:e.videoWidth,height:e.videoHeight})},t=()=>void e(O);if(!(O.readyState>=1))return O.addEventListener("loadedmetadata",t),()=>{O.removeEventListener("loadedmetadata",t)};e(O)},_=[O],B[11]=O,B[12]=m,B[13]=_):(m=B[12],_=B[13]),(0,n.useEffect)(m,_),B[14]===Symbol.for("react.memo_cache_sentinel")?(f=function(e){G(e.target.value)},B[14]=f):f=B[14];let Z=f;B[15]!==L||B[16]!==C||B[17]!==Y||B[18]!==Q||B[19]!==K||B[20]!==W||B[21]!==E?(h=async function(){if(!Q)return;(0,i.logEventVideoExtendVideo)(),R(!0);let e=E.trim(),t=await C(e);if("error"===t.status){R(!1),K({title:"Error",body:t.error}),W(!0);return}Y.mutateAsync({nodeToUpdate:{...t.value},apiData:{text:e,input_image:Q.base64,video_model:L}}),R(!1),G("")},B[15]=L,B[16]=C,B[17]=Y,B[18]=Q,B[19]=K,B[20]=W,B[21]=E,B[22]=h):h=B[22];let J=h;B[23]!==z||B[24]!==C||B[25]!==H||B[26]!==q.id||B[27]!==K||B[28]!==W||B[29]!==E?(v=async function(e){R(!0);let t=await H.mutateAsync({blob:e,description:e.name});await z.mutateAsync({projectId:q.id,assetId:t.id});let a=E.trim(),l=await C(a,t.media_file.blob);if("error"===l.status){R(!1),K({title:"Error",body:l.error}),W(!0);return}R(!1)},B[23]=z,B[24]=C,B[25]=H,B[26]=q.id,B[27]=K,B[28]=W,B[29]=E,B[30]=v):v=B[30];let $=v;B[31]!==F||B[32]!==E?(A=F||""===E.trim(),B[31]=F,B[32]=E,B[33]=A):A=B[33];let X=A;B[34]!==F||B[35]!==E?(p=(0,t.jsx)("textarea",{value:E,onChange:Z,disabled:F}),B[34]=F,B[35]=E,B[36]=p):p=B[36],B[37]!==F?(g=(0,t.jsx)(N,{disabled:F}),B[37]=F,B[38]=g):g=B[38];let ee=X?"Describe next scene before uploading":"Use this to brainstorm your storyline with a placeholder image. To transform this into a video, you'll need to completely regenerate the branch";B[39]!==$||B[40]!==X||B[41]!==ee?(S=(0,t.jsx)(V.AttachPromptImageButton,{disabled:X,onFileSubmit:$,label:"Upload Placeholder",tooltipText:ee}),B[39]=$,B[40]=X,B[41]=ee,B[42]=S):S=B[42],B[43]!==g||B[44]!==S?(b=(0,t.jsxs)("div",{className:M.default.LeftButtons,children:[g,S]}),B[43]=g,B[44]=S,B[45]=b):b=B[45];let et=""===E||F;return B[46]===Symbol.for("react.memo_cache_sentinel")?(y=(0,t.jsx)(T.ArrowRight,{}),B[46]=y):y=B[46],B[47]!==J||B[48]!==et?(I=(0,t.jsx)("button",{className:M.default.SubmitButton,onClick:J,disabled:et,children:y}),B[47]=J,B[48]=et,B[49]=I):I=B[49],B[50]!==b||B[51]!==I?(x=(0,t.jsxs)("div",{className:M.default.InputBottomBar,children:[b,I]}),B[50]=b,B[51]=I,B[52]=x):x=B[52],B[53]!==p||B[54]!==x?(j=(0,t.jsxs)("div",{className:M.default.NewNodeButtonContainer,children:[p,x]}),B[53]=p,B[54]=x,B[55]=j):j=B[55],j}var F=e.i(27030),R=e.i(70259),Q=e.i(40137),P=e.i(95312),L=e.i(68263);function W(e){let l,o,s,i,r,d,u,c,_=(0,a.c)(21),{sourceValue:f,label:h,activeNode:v}=e,[A,p]=(0,n.useState)(!1),{saveNode:g}=(0,m.useVideoGenActions)(),[S,b]=(0,n.useState)(f??h);_[0]!==v||_[1]!==g?(l=async function(e){if(!v)return;let t=e.trim();if(t==v.label)return;let a={...v,label:t};await g(v,a)},_[0]=v,_[1]=g,_[2]=l):l=_[2];let N=l,y=A?S:f??h;return _[3]===Symbol.for("react.memo_cache_sentinel")?(o=e=>b(e.target.value),_[3]=o):o=_[3],_[4]!==S||_[5]!==N?(s=()=>{p(!1),N(S)},_[4]=S,_[5]=N,_[6]=s):s=_[6],_[7]!==h||_[8]!==f?(i=()=>{b(f??h),p(!1)},_[7]=h,_[8]=f,_[9]=i):i=_[9],_[10]!==y||_[11]!==A||_[12]!==s||_[13]!==i?(r=(0,t.jsx)(R.default,{value:y,onChange:o,className:L.default.LabelEditor,isEditing:A,onSave:s,onCancel:i}),_[10]=y,_[11]=A,_[12]=s,_[13]=i,_[14]=r):r=_[14],_[15]===Symbol.for("react.memo_cache_sentinel")?(d=()=>p(!0),_[15]=d):d=_[15],_[16]!==A?(u=(0,t.jsx)(Q.SmallIconButton,{className:L.default.EditButton,onClick:d,icon:P.default,disabled:A}),_[16]=A,_[17]=u):u=_[17],_[18]!==r||_[19]!==u?(c=(0,t.jsxs)("div",{className:L.default.LabelContainer,children:[r,u]}),_[18]=r,_[19]=u,_[20]=c):c=_[20],c}function K({activeNode:e,videoRef:a}){let{saveNewChildNode:l}=(0,m.useVideoGenActions)(),o=(0,m.useNextNodes)();async function n(e,t){let a=e.trim().replace(/(\r\n|\n|\r)/gm," ").replace(/[^a-zA-Z0-9 .]/g,""),o={label:a,video:null,image:t||null,choices:[],prompt:null},n=await l(o,a);return"success"===n.status?(0,F.success)(o):(0,F.failure)(n.error)}if(!e)return null;let s=null!==e.video;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:s?"Your scene":"Your Placeholder Scene"}),(0,t.jsx)(W,{activeNode:e,sourceValue:e.label,label:"Label"},`label-${e.label}`),(0,t.jsx)("p",{children:"What happens next?"}),s&&a.current?(0,t.jsx)(U,{addNewNode:n,videoElement:a.current}):(0,t.jsx)(q,{addNewNode:n}),o.length>0&&(0,t.jsx)("div",{className:C.default.NextNodes,children:o.map((e,a)=>(0,t.jsx)(G,{node:e},e.label+a))})]})}var H=e.i(18566),z=e.i(81520),Y=e.i(73818);function Z(e){let o,i,d,u,c,_,f,h,v,A,p,g,S,b,N=(0,a.c)(34),{activeNode:y}=e,[I,x]=(0,n.useState)(!1),{saveNode:w}=(0,m.useVideoGenActions)(),{setOpen:j,setContent:B}=(0,D.useDialog)(),O=(0,l.useQueryClient)(),E=(0,m.useNextNodes)(),G=(0,H.useParams)().projectId,V=(0,s.useAddAssetToProjectMutation)();N[0]!==O?(o={onSettled:()=>{O.invalidateQueries({queryKey:["assets"]}),O.invalidateQueries({queryKey:["projects"]})}},N[0]=O,N[1]=o):o=N[1];let M=(0,s.useUploadAssetMutation)(o);N[2]!==y||N[3]!==w?(i=async function(e,t){let a={label:y.label,video:t||null,image:e||null,choices:[],prompt:null};await w(y,a)},N[2]=y,N[3]=w,N[4]=i):i=N[4];let q=i;N[5]!==V||N[6]!==M||N[7]!==G||N[8]!==B||N[9]!==j||N[10]!==q?(d=async function(e){let t=e[0],a=t.type.includes("image/"),l=t.type.includes("video/");if(!a&&!l){j(!0),B({title:"Error",body:"This drop area only accepts videos or images."});return}x(!0);let o=await M.mutateAsync({blob:t,description:t.name});await V.mutateAsync({projectId:G,assetId:o.id}),await q(a?o.media_file.blob:void 0,l?o.media_file.blob:void 0),x(!1)},N[5]=V,N[6]=M,N[7]=G,N[8]=B,N[9]=j,N[10]=q,N[11]=d):d=N[11];let k=d;if(!y)return null;N[12]===Symbol.for("react.memo_cache_sentinel")?(u=(0,t.jsx)("p",{children:"Your scene"}),N[12]=u):u=N[12];let T=`label-${y.label}`;return N[13]!==y||N[14]!==T?(c=(0,t.jsx)(W,{activeNode:y,sourceValue:y.label,label:"Label"},T),N[13]=y,N[14]=T,N[15]=c):c=N[15],N[16]===Symbol.for("react.memo_cache_sentinel")?(_=(0,t.jsx)("p",{children:"Drag and drop Video or Image"}),f=(0,t.jsx)("p",{children:"or"}),h=(0,t.jsx)("span",{className:"upload-button",children:"Browse for Asset"}),N[16]=_,N[17]=f,N[18]=h):(_=N[16],f=N[17],h=N[18]),N[19]===Symbol.for("react.memo_cache_sentinel")?(v=(0,t.jsxs)("p",{children:["Files must be under ",(0,t.jsx)("strong",{children:"19MB"})]}),N[19]=v):v=N[19],N[20]!==I?(A=I&&(0,t.jsxs)("div",{className:Y.default.Uploading,children:[(0,t.jsx)("p",{children:"Uploading..."}),(0,t.jsx)(r.default,{wrapperClass:"",ariaLabel:"loading-indicator",strokeWidth:6})]}),N[20]=I,N[21]=A):A=N[21],N[22]!==A?(p=(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("section",{className:Y.default.DragDropText,children:[_,f,h,v,A]})}),N[22]=A,N[23]=p):p=N[23],N[24]!==I||N[25]!==k||N[26]!==p?(g=(0,t.jsx)(z.default,{onSubmit:k,acceptedFileTypes:"video/*, image/*",multipleFiles:!1,isDisabled:I,children:p}),N[24]=I,N[25]=k,N[26]=p,N[27]=g):g=N[27],N[28]!==E?(S=E.length>0&&(0,t.jsx)("div",{className:C.default.NextNodes,children:E.map(J)}),N[28]=E,N[29]=S):S=N[29],N[30]!==g||N[31]!==S||N[32]!==c?(b=(0,t.jsxs)(t.Fragment,{children:[u,c,g,S]}),N[30]=g,N[31]=S,N[32]=c,N[33]=b):b=N[33],b}function J(e,a){return(0,t.jsx)(G,{node:e},e.label+a)}function $(){let e,l,s,i,r,d,u,c=(0,a.c)(20),{activeNode:_}=(0,m.useActiveNode)(),[f,h]=(0,n.useState)(_.video??""),[A,p]=(0,n.useState)(_.image),g=(0,n.useRef)(null);c[0]!==_.image||c[1]!==_.video?(e=()=>{_.video&&h(_.video),_.image&&p(_.image)},c[0]=_.image,c[1]=_.video,c[2]=e):e=c[2],c[3]!==_?(l=[_,_.image,_.video],c[3]=_,c[4]=l):l=c[4],(0,n.useEffect)(e,l),c[5]===Symbol.for("react.memo_cache_sentinel")?(s=function(){p(null)},c[5]=s):s=c[5];let S=s,b=null!==_.video,N=null!==A,y=!b&&!N;return c[6]!==b||c[7]!==f?(i=f&&(0,t.jsx)("video",{src:f,ref:g,className:(0,v.default)(!b&&C.default.Hidden),controls:!0,autoPlay:!1,muted:!0,preload:"auto",onLoadedMetadata:ee,onLoadedData:X,crossOrigin:"anonymous"}),c[6]=b,c[7]=f,c[8]=i):i=c[8],c[9]!==_.image||c[10]!==N||c[11]!==b?(r=!b&&N&&(0,t.jsxs)("div",{className:C.default.ImageContainer,children:[(0,t.jsx)(o.default,{src:_.image,alt:"Preview image",width:500,height:500}),(0,t.jsx)("button",{className:C.default.TrashContainer,onClick:S,"aria-label":"Delete image",children:(0,t.jsx)(B.default,{})})]}),c[9]=_.image,c[10]=N,c[11]=b,c[12]=r):r=c[12],c[13]!==_||c[14]!==y?(d=y?(0,t.jsx)(Z,{activeNode:_}):(0,t.jsx)(K,{activeNode:_,videoRef:g}),c[13]=_,c[14]=y,c[15]=d):d=c[15],c[16]!==i||c[17]!==r||c[18]!==d?(u=(0,t.jsxs)("div",{className:C.default.NodeEditor,children:[i,r,d]}),c[16]=i,c[17]=r,c[18]=d,c[19]=u):u=c[19],u}function X(e){e.currentTarget.pause()}function ee(e){e.currentTarget.currentTime=.01}},60038,e=>{e.v({BreadCrumbsContainer:"VideoGenBreadcrumbs-module-scss-module__FBJaRG__BreadCrumbsContainer",BreadCrumbsWrapper:"VideoGenBreadcrumbs-module-scss-module__FBJaRG__BreadCrumbsWrapper",fadeAndScaleIn:"VideoGenBreadcrumbs-module-scss-module__FBJaRG__fadeAndScaleIn",fadeAndScaleOut:"VideoGenBreadcrumbs-module-scss-module__FBJaRG__fadeAndScaleOut",pulseBackground:"VideoGenBreadcrumbs-module-scss-module__FBJaRG__pulseBackground",scaleIn:"VideoGenBreadcrumbs-module-scss-module__FBJaRG__scaleIn",scaleOut:"VideoGenBreadcrumbs-module-scss-module__FBJaRG__scaleOut"})},11639,e=>{e.v({VideoGenerationGameMaker:"VideoGenerationGameMaker-module-scss-module__U0W0YG__VideoGenerationGameMaker",fadeAndScaleIn:"VideoGenerationGameMaker-module-scss-module__U0W0YG__fadeAndScaleIn",fadeAndScaleOut:"VideoGenerationGameMaker-module-scss-module__U0W0YG__fadeAndScaleOut",pulseBackground:"VideoGenerationGameMaker-module-scss-module__U0W0YG__pulseBackground",scaleIn:"VideoGenerationGameMaker-module-scss-module__U0W0YG__scaleIn",scaleOut:"VideoGenerationGameMaker-module-scss-module__U0W0YG__scaleOut"})},47516,e=>{"use strict";e.s(["DATA_FOLDER",()=>g,"default",()=>S],47516);var t=e.i(18050),a=e.i(932),l=e.i(36382),o=e.i(57688),n=e.i(71645),s=e.i(55689),i=e.i(12086),r=e.i(88867);e.i(80380);var d=e.i(14978),u=e.i(21514),c=e.i(39809),m=e.i(98600),_=e.i(81234),f=e.i(60038),h=e.i(6801);function v(){let e,l,o,s,i,r,d,u=(0,a.c)(16),c=(0,n.useRef)(null),{activeNode:v,setActiveNode:A}=(0,h.useActiveNode)(),{breadcrumbs:p}=(0,h.useVideoGenBreadcrumbs)();if(u[0]===Symbol.for("react.memo_cache_sentinel")?(e=()=>{c.current&&c.current.scrollIntoView({behavior:"smooth",block:"nearest",inline:"end"})},u[0]=e):e=u[0],u[1]!==p?(l=[p],u[1]=p,u[2]=l):l=u[2],(0,n.useEffect)(e,l),u[3]!==p||u[4]!==A){let e;u[6]!==A?(e=(e,a)=>(0,t.jsxs)(n.Fragment,{children:[(0,t.jsx)("button",{onClick:()=>A(e),children:e.label}),(0,t.jsx)(_.ChevronRight,{})]},`breadcrumb-${a}`),u[6]=A,u[7]=e):e=u[7],o=p.map(e),u[3]=p,u[4]=A,u[5]=o}else o=u[5];return u[8]!==v.label?(s=(0,t.jsx)("span",{ref:c,children:v.label}),u[8]=v.label,u[9]=s):s=u[9],u[10]!==o||u[11]!==s?(i=(0,t.jsxs)("div",{className:f.default.BreadCrumbsContainer,children:[o,s]}),u[10]=o,u[11]=s,u[12]=i):i=u[12],u[13]===Symbol.for("react.memo_cache_sentinel")?(r=(0,t.jsx)(m.default,{}),u[13]=r):r=u[13],u[14]!==i?(d=(0,t.jsxs)("div",{className:f.default.BreadCrumbsWrapper,children:[i,r]}),u[14]=i,u[15]=d):d=u[15],d}var A=e.i(11639),p=e.i(67270);let g="/VideoData";function S(){let e,m,_,f,g,S,I,x,w=(0,a.c)(13),{project:j}=(0,d.default)(),{isNewProject:B}=(0,h.useVideoGenData)(),{activeNode:C}=(0,h.useActiveNode)(),O=(0,p.useVideoChatSwitcherStore)(j.id,y);w[0]!==O?(e=()=>{O("video")},m=[O],w[0]=O,w[1]=e,w[2]=m):(e=w[1],m=w[2]),(0,n.useEffect)(e,m),w[3]===Symbol.for("react.memo_cache_sentinel")?(_={filters:{mutationKey:s.VIDEO_MUTATION_KEY,status:"pending"},select:N},w[3]=_):_=w[3];let E=(0,l.useMutationState)(_).length>0;return w[4]!==E?(f={shouldPrevent:E,onNavigationAttemptAction:b},w[4]=E,w[5]=f):f=w[5],(0,r.usePreventNavigation)(f),w[6]===Symbol.for("react.memo_cache_sentinel")?(g=(0,t.jsx)(v,{}),S=(0,t.jsx)(o.default,{alt:"futuristic semi-transparent fadeaway grid pattern background",src:i.default,fill:!0,placeholder:"blur"}),w[6]=g,w[7]=S):(g=w[6],S=w[7]),w[8]!==C||w[9]!==B?(I=C&&(B?(0,t.jsx)(u.default,{}):(0,t.jsx)(c.default,{})),w[8]=C,w[9]=B,w[10]=I):I=w[10],w[11]!==I?(x=(0,t.jsxs)("div",{className:A.default.VideoGenerationGameMaker,children:[g,S,I]}),w[11]=I,w[12]=x):x=w[12],x}function b(){return console.warn("Navigation attempt blocked due to video generation")}function N(e){return"pending"===e.state.status}function y(e){return e.setActiveMode}}]);